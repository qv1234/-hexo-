{"type":"getPostByPath","data":{"title":"HCIP-网络类型GREOSPF","date":"2023-03-19T11:48:57.116Z","description":"","categories":[{"name":"网络","_id":"clfgd5gdh000y70q4aopo5bql"}],"tags":[{"name":"网络","_id":"clfgd5gdi000z70q485coagt1"}],"content":"<h2 id=\"1-广域网技术：\"><a href=\"#1-广域网技术：\" class=\"headerlink\" title=\"1.广域网技术：\"></a>1.广域网技术：</h2><h3 id=\"1-概念：\"><a href=\"#1-概念：\" class=\"headerlink\" title=\"1.概念：\"></a>1.概念：</h3><ul>\n<li>二层封装技术</li>\n<li>网络速率：（带宽 &#x2F; 8）* 85%</li>\n<li>全双工：收发同时</li>\n<li>半双工：单向收发，终端在单个时间，只能在收发间仅处于一种状态</li>\n</ul>\n<h3 id=\"2-网络类型：\"><a href=\"#2-网络类型：\" class=\"headerlink\" title=\"2.网络类型：\"></a>2.网络类型：</h3><ul>\n<li>概念：因为物理层在网络成长过程中，不定的变化，升级，故对应的数据链路层技术也不断在进行升级和变化；基于不同数据链路的特征将其分为了不同的网络类型</li>\n<li>分类：<ul>\n<li><strong>点到点</strong>网络（P2P）：在一个物理网络中，有且仅有两个节点；不需要通过地址进行区分，物理和逻辑珊珊均不接受第三节点</li>\n<li>多点接入型网络（MA）：多路访问，在一个网段中，节点的数量不限制<ul>\n<li>BMA：广播型多路访问，在一个MA网络中，同时存在广播机制</li>\n<li>NBMA：非广播型多路访问，在一个MA网络中，不存在广播机制</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-点到点网络类型：\"><a href=\"#2-点到点网络类型：\" class=\"headerlink\" title=\"2.点到点网络类型：\"></a>2.点到点网络类型：</h2><h3 id=\"1-HDLC高级链路控制协议：\"><a href=\"#1-HDLC高级链路控制协议：\" class=\"headerlink\" title=\"1.HDLC高级链路控制协议：\"></a>1.HDLC高级链路控制协议：</h3><ul>\n<li><p>属于<strong>点到点网络类型</strong>，没有二层单播地址</p>\n</li>\n<li><p>分类：</p>\n<ul>\n<li><p>标准HDLC：ISO组织在SDLC的基础上改进所颁布的符合工业标准的HDLC</p>\n</li>\n<li><p>非标准的HDLC：各大厂商在标准额HDLC额基础上改进而来。</p>\n</li>\n</ul>\n</li>\n<li><p>物理网线为串线链路，<strong>思科默认使用的是HDLC，华为默认使用PPP</strong></p>\n</li>\n<li><p>修改接口协议为HDLC</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">先进入此接口</span></span><br><span class=\"line\">link-protocol hdlc</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看接口二层特征：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display interface s4/0/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>HDLC在数据链路层，实际没有过多的动作，主要工作为控制物理层</p>\n</li>\n</ul>\n<h3 id=\"2-PPP点到点协议：\"><a href=\"#2-PPP点到点协议：\" class=\"headerlink\" title=\"2.PPP点到点协议：\"></a>2.PPP点到点协议：</h3><ul>\n<li><p>属于<strong>点到点网络协议</strong>，<strong>华为设备默认</strong>串口封装技术，HDLC的升级版</p>\n</li>\n<li><p>PPP协议包含多个附属协议，也可以理解为成员协议</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112200101994.png\" alt=\"image-20221112200101994\"></p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112200114670.png\" alt=\"image-20221112200114670\"></p>\n<ul>\n<li>F – flag — 类似于以太网中的前导符 — 01111110</li>\n<li>A – Address — 11111111</li>\n<li>C – Control — 00000011</li>\n</ul>\n</li>\n<li><p>优点：</p>\n<ol>\n<li><p>兼容性强</p>\n</li>\n<li><p>可移植性强</p>\n</li>\n<li><p>可以进行认证和授权</p>\n</li>\n</ol>\n</li>\n<li><p><strong>工作过程：</strong>PPP协议和TCP协议类似，在正式传输数据之前，也需要建立PPP会话</p>\n<ol>\n<li><p>链路建立阶段：LCP建立，链路控制协议，就是通过LCP协议链路相关参数，之后根据协商好的参数建立链路</p>\n<p>MRU：PPP帧中数据部分所允许携带的最大长度（字节），默认值1500；因为第二阶段认证阶段是可选项，所以是否需要认证以及认证方式，需要在LCP建立阶段完成协商</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112200358926.png\" alt=\"image-20221112200358926\"></p>\n</li>\n<li><p>认证阶段：可选项，PPP在认证时需要调用AAA来认证（单向认证和双向认证）</p>\n<ul>\n<li><h3 id=\"PAP-（密码认证协议）：\"><a href=\"#PAP-（密码认证协议）：\" class=\"headerlink\" title=\"PAP （密码认证协议）：\"></a>PAP （密码认证协议）：</h3><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112202212295.png\" alt=\"image-20221112202212295\" style=\"zoom:67%;\" />\n\n<ul>\n<li>被认证方将用户名和密码信息以明文的形式发送给认证方</li>\n<li>对方回复ACK则代表认证成功，回复NAK则代表不成功</li>\n</ul>\n</li>\n<li><h3 id=\"CHAP（挑战握手协议）：通过比对摘要值的方式进行认证\"><a href=\"#CHAP（挑战握手协议）：通过比对摘要值的方式进行认证\" class=\"headerlink\" title=\"CHAP（挑战握手协议）：通过比对摘要值的方式进行认证\"></a>CHAP（挑战握手协议）：通过比对摘要值的方式进行认证</h3><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112203110588.png\" alt=\"image-20221112203110588\" style=\"zoom:67%;\" />\n\n<ul>\n<li><p>摘要值：HASH算法（散列函数）可以将任意长度的输入转换成固定长度的输出</p>\n<ul>\n<li>相同输入，相同输出</li>\n<li>不可逆性</li>\n<li>雪崩效应</li>\n</ul>\n</li>\n<li><p>MD5是HASH算法的一种 — 可以将任意长度的输入，转换成128位的输出。</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>网络层协议协商阶段：NCP协商</p>\n<ul>\n<li>网络控制协议，一堆协议的集合，具体使用哪一个取决于网络层选择的协议类型，如果网络层</li>\n<li>协商的内容：1.IP地址，2.IP报文的压缩格式</li>\n</ul>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221112203715087.png\" alt=\"image-20221112203715087\" style=\"zoom:67%;\" /></li>\n</ol>\n</li>\n<li><p>PPP会话是一次性会话</p>\n</li>\n<li><h3 id=\"PAP认证（明文）：\"><a href=\"#PAP认证（明文）：\" class=\"headerlink\" title=\"PAP认证（明文）：\"></a>PAP认证（明文）：</h3><ul>\n<li><p>主认证（服务端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aaa     # 进入aaa模式</span><br><span class=\"line\">local-user [用户名] privilege level [权限值] password cipher [密码]</span><br><span class=\"line\">local-user [用户名] service-type ppp   </span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ppp authentication-mode pap     # 在对应接口中，开启PAP认证</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>被认证（客户端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ppp pap local-user [用户名] password cipher [密码]   # 先进入对应的接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><h3 id=\"CHAP认证（密文）：\"><a href=\"#CHAP认证（密文）：\" class=\"headerlink\" title=\"CHAP认证（密文）：\"></a>CHAP认证（密文）：</h3><ul>\n<li><p>通过比对摘要值的方式进行认证</p>\n</li>\n<li><p>主认证（服务端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aaa     # 进入aaa模式</span><br><span class=\"line\">local-user [用户名] privilege level [权限值] password cipher [密码]</span><br><span class=\"line\">local-user [用户名] service-type ppp   # 该账号只用于什么登录</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ppp authentication-mode chap     # 在对应接口中</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>被认证（客户端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">先进入接口</span></span><br><span class=\"line\">ppp chap password cipher [密码] </span><br><span class=\"line\">ppp chap user [用户名]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><h3 id=\"IPCP配置：\"><a href=\"#IPCP配置：\" class=\"headerlink\" title=\"IPCP配置：\"></a>IPCP配置：</h3><ul>\n<li><p>认证方：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">remote address 1.1.1.1     # 先进入接口，前提是本接口已经配置IP地址</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>被认证方：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip address ppp-negotiate   # 先进入接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3-GRE通用路由封装：\"><a href=\"#3-GRE通用路由封装：\" class=\"headerlink\" title=\"3.GRE通用路由封装：\"></a>3.GRE通用路由封装：</h3><ul>\n<li><p>属于<strong>点到点网络类型</strong>，虚拟技术，不关注物理层</p>\n</li>\n<li><p>一种简单的VPN（虚拟专用网络）</p>\n</li>\n<li><p>VPN技术的核心技术是隧道技术，隧道技术的核心技术是封装技术</p>\n</li>\n<li><p>隧道技术：在隧道的两端通过封装以及解封装技术，在公网上建立一条数据通道，使用这条通道来进行数据传输</p>\n</li>\n<li><p>配置：（两端都要配置）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int Tunnel0/0/0   # 创建进入隧道接口</span><br><span class=\"line\">ip add 10.1.1.1 24    # 配置隧道接口IP地址</span><br><span class=\"line\">tunnel-protocol gre     # 定义封装标准</span><br><span class=\"line\">source 12.1.1.1         # 新增报头的源IP（真实的物理接口的IP地址）</span><br><span class=\"line\">destination 23.1.1.2    # 新增报头的目标IP地址（真实的物理接口的IP地址）</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static [IP地址] [子网掩码/长度] [当前路由器隧道接口号]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">例：</span></span><br><span class=\"line\">ip route-static 192.168.2.0 24 t0/0/1</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"3-多点接入型网络类型：\"><a href=\"#3-多点接入型网络类型：\" class=\"headerlink\" title=\"3.多点接入型网络类型：\"></a>3.多点接入型网络类型：</h2><h3 id=\"1-以太网：\"><a href=\"#1-以太网：\" class=\"headerlink\" title=\"1.以太网：\"></a>1.以太网：</h3><ul>\n<li><p>以太网技术被定为<strong>BMA网络</strong>类型（MA网络，存在多个节点，故必须拥有二层单播地址）</p>\n</li>\n<li><p>以太网：共享型，共享物理链路，将不同频段，且相互不干涉波点的电流，集中于一条物理介质进行传输，起到带宽叠加的作用</p>\n</li>\n<li><p>以太网协议的特点：需要通过MAC地址对设备进行区分和标定（主要因为利用以太网所构建的二层网路可以包含两个或两个以上接口，每个以太网接口都可以通过交互以太网帧的形式来进行二层通信）</p>\n</li>\n<li><p>物理网线：RJ-45双绞线（传输数字信号），同轴电缆（传输数字信号），RJ-11电话线（模拟信号），光纤（光信号）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RJ-11电话线和光纤均需要调制解调器（猫）进行信号转换</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>无线：WIFI，移动通信</p>\n</li>\n<li><p>以太网的核心技术：频分，一条电缆多个频率（信道）</p>\n</li>\n<li><p>频分复用：频分就是传输介质上可以同时发送不同频段的电流而互不干扰，实现数据的并行发送。</p>\n</li>\n<li><p>以太网使用的是mac地址，存在广播，洪泛机制</p>\n</li>\n</ul>\n<h3 id=\"2-多点GRE：\"><a href=\"#2-多点GRE：\" class=\"headerlink\" title=\"2.多点GRE：\"></a>2.多点GRE：</h3><ul>\n<li><p>属于<strong>NBMA</strong>网络</p>\n</li>\n<li><p>若使用点到点的GRE再多个节点的情况下，组件VPN环境，VPN数量，网段数量，固定IP数量，路由条目数量随着节点的增加成指数的上升</p>\n</li>\n<li><p><strong>MGRE：</strong></p>\n<ul>\n<li>所有节点存在同一个MA网段，且为中心到站点结构，该结构中，默认仅中心站点需要固有公有IP地址，分支站点地址可变化；</li>\n<li>优点：大大减低了管理难度，资源占有量，成本。</li>\n<li>MRGE环境为NBMA环境，在NBMA环境中，不支持广播，洪泛机制；若需要进行广播消息转发，可以借鉴伪广播规则，向该网段所有节点进行单播转发，来实现广播效果。</li>\n</ul>\n</li>\n<li><h3 id=\"NHRP下一跳路径发现协议：\"><a href=\"#NHRP下一跳路径发现协议：\" class=\"headerlink\" title=\"NHRP下一跳路径发现协议：\"></a>NHRP下一跳路径发现协议：</h3><ul>\n<li>存在<strong>服务端和客户端</strong></li>\n<li>NHS：下一跳解析服务器</li>\n<li>MAP：记录客户端的公有IP与Tunnel的IP地址对应关系</li>\n<li>工作原理：<ol>\n<li>先私网中选出一个出口物理IP地址不会发生变化的设备成为NHS，分支都需要知道中心的隧道IP地址和物理接口IP地址</li>\n<li>所有分支需要将<strong>自己物理接口和隧道接口的映射关系</strong>发送给NHS</li>\n<li>如果分支出接口的IP地址发生变化，则需要将最新的映射关系发送给中心，中心生成MAP</li>\n<li>之后，中心发送消息，只需要依靠记录表搭建隧道；分支和分支之间通信，可以先找中心下载映射表，分支再根据映射关系搭建隧道，进行通信</li>\n</ol>\n</li>\n<li>我们MGRE环境在逻辑拓扑上是一个多点接入的网络，但是，在数据收发时，依然是走的是点到点的隧道，所以，这样的网络中是不支持广播行为，所以，可以将它理解为是一种NBMA的网络。</li>\n</ul>\n</li>\n<li><p>一个真实接口上只允许建立一个mgre</p>\n</li>\n<li><p>中心站点（服务端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int Tunnel0/0/0   # 创建进入隧道接口</span><br><span class=\"line\">ip add [隧道接口IP地址] [子网掩码/长度]    # 配置隧道接口IP地址</span><br><span class=\"line\">tunnel-protocol gre p2mp     # 定义封装标准,工作模式为点到多点</span><br><span class=\"line\">source [真实接口IP地址]         # 新增报头的源IP（真实的物理接口的IP地址）</span><br><span class=\"line\">nhrp entry multicast dynamic   # 启动nhrp，开启伪广播（应用于只有中心获取到RIP路由的情况）</span><br><span class=\"line\">nhrp network-id [num]     # 定义nhrp域id号,默认100</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display nhrp peer all    # 查看分支站点注册结果</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>分支站点（客户端）配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int Tunnel0/0/0   # 创建进入隧道接口</span><br><span class=\"line\">ip add [隧道接口IP地址] [子网掩码/长度]    # 配置隧道接口IP地址</span><br><span class=\"line\">tunnel-protocol gre p2mp     # 定义封装标准,工作模式为点到多点</span><br><span class=\"line\">source [真实物理接口号]/[真实物理接口IP地址]        # 新增报头的源IP（真实的物理接口号或真实物理接口IP地址）</span><br><span class=\"line\">nhrp entry [Tunnel接口IP地址] [物理接口IP地址] register    # 配置中心站点的Tunnel地址，物理地址</span><br><span class=\"line\">nhrp network-id 100   # 加入中心站点所创建的nhrp域</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>点到点静态路由配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static [IP地址] [子网掩码/长度] [对面隧道接口号]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">例：</span></span><br><span class=\"line\">ip route-static 192.168.2.0 24 t0/0/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>点到点RIP动态路由配置：（宣告的私网的地址网段和隧道端口网段地址）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rip      # 启动RIP：（配置模式下，启动时可以定义进程号，默认1，范围1~65535）</span><br><span class=\"line\">version [num]   # 选择版本：（版本1：其他路由获取得到的IP地址是主类，版本2：其他路由获取得到的IP地址是精确的网络地址）</span><br><span class=\"line\">network [端口网络地址主类]   # 宣告，被选中接口可以收发RIP的信息和共享给本地的所有邻居</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">完成后服务端和客户端之间的192.168网段可以通过Tunnel接口互相访问</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int [隧道接口号]</span><br><span class=\"line\">undo rip split-horizon   # 关闭此接口的水平分割，表示可以从此口进，也可以从此口出</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">关闭水平分割后客户端可以与客户端通信</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"3-OSPF：\"><a href=\"#3-OSPF：\" class=\"headerlink\" title=\"3.OSPF：\"></a>3.OSPF：</h2><h3 id=\"1-HICA-OSPF：\"><a href=\"#1-HICA-OSPF：\" class=\"headerlink\" title=\"1.HICA-OSPF：\"></a>1.HICA-OSPF：</h3><ul>\n<li><p>OSPF：开放式最短路径优先协议，<strong>无类别（带掩码）链路状态igp协议</strong>，周期更新（30min）+触发更新</p>\n</li>\n<li><p>跨四层封装（传输层），基于IP封装，协议号89</p>\n</li>\n<li><p>版本：v1（实验室阶段夭折），v2（IPv4），v3（IPv6）</p>\n</li>\n<li><p>链路状态协议的更新量随着网络范围的扩展指数性的上升，因此OSFP协议为了在中大型网络中工作，<strong>需要结构化的部署</strong>（<strong>区域之内传递拓扑，区域传递路由</strong>）</p>\n</li>\n<li><p>为什么需要结构化部署：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">因为OSPF是无类别链路状态IGP协议，而链路状态最大的特点就是共享拓扑，而共享拓扑；而共享拓扑的话就会产生大量的更新这样不利于网络的流通，因此需要合理的流畅，因此需要合理的IP规划，进行结构化部署。区域之内是LSA的拓扑数据交换：区域之内传递拓扑，区域传递路由</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>区域划分的目的或链路状态协议的距离矢量特征：区域之内传递拓扑，区域传递路由</p>\n</li>\n<li><p>更新方式：组播更新（224.0.0.5（all），224.0.0.6（DR&#x2F;BDR））</p>\n</li>\n<li><p>算法：SPF（最短路径优先算法）</p>\n</li>\n<li><h3 id=\"OSPF所有报文头部：\"><a href=\"#OSPF所有报文头部：\" class=\"headerlink\" title=\"OSPF所有报文头部：\"></a>OSPF所有报文头部：</h3><table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>版本（8bit）</td>\n<td>OSPF协议的版本，v1：1，v2：2，v3：3</td>\n</tr>\n<tr>\n<td>类型（8bit）</td>\n<td>OSPF数据包的类型，Hello：1，DBD：2，LSR：3，LSU：4，LSACK：5</td>\n</tr>\n<tr>\n<td>报文长度（bit）</td>\n<td>OSPF中整个报文的长度</td>\n</tr>\n<tr>\n<td>路由器ID（32bit）</td>\n<td>携带的发出数据包设备的RID</td>\n</tr>\n<tr>\n<td>区域ID（32bit）</td>\n<td>发出数据包的接口所在区域的ID</td>\n</tr>\n<tr>\n<td>效验和（16bit）</td>\n<td>确保数据的完整性</td>\n</tr>\n<tr>\n<td>验证类型（16bit）</td>\n<td>做数据认证，分为三种 NULL（不认证）：0，simple明文认证：1，MD5：2</td>\n</tr>\n<tr>\n<td>认证数据（32bit）</td>\n<td>做数据认证</td>\n</tr>\n</tbody></table>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221115210846933.png\" alt=\"image-20221115210846933\" style=\"zoom:67%;\" />\n</li>\n<li><h3 id=\"OSPF的五种数据包：\"><a href=\"#OSPF的五种数据包：\" class=\"headerlink\" title=\"OSPF的五种数据包：\"></a>OSPF的五种数据包：</h3><ol>\n<li><p>Hello：1.邻居的发现，关系的建立；2.周期（以太网10s）的保活；3.携带rid（IP地址格式），4.DR &#x2F; BDR 选举</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>网络掩码</td>\n<td>邻居双方这个参数必须相同才能正常建立邻居关系（但是，这个参数在点到点网络中是不生效的）</td>\n</tr>\n<tr>\n<td>hello间隔</td>\n<td>hello time，dead time 如果不相同，则邻居关系无法建立可选项</td>\n</tr>\n<tr>\n<td>可选项</td>\n<td>每一个标记位都代表设备遵循OSPF的某一种特性，其中<strong>包含特殊区域的标记位</strong>。这个标记位不同，则邻居关系无法正常建立</td>\n</tr>\n<tr>\n<td>路由器优先级</td>\n<td>路由器接口参选的优先级</td>\n</tr>\n<tr>\n<td>指定路由器，备份指定路由器</td>\n<td>在没选出来之前，使用0.0.0.0进行填充，选出来之后，将对应接口的IP地址进行携带</td>\n</tr>\n</tbody></table>\n<p>影响邻居关系建立的参数：1.Router-id、Area-id，2.hello时间，3.dead time，4.特殊区域标记位，5.认证</p>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221116083903629.png\" alt=\"image-20221116083903629\" style=\"zoom:67%;\" />\n</li>\n<li><p>Dbd：数据库描述报文（本地数据库目录（发送链路状态中自身知道的）），LSDB：链路状态数据库，存储LSA信息的数据库</p>\n<ul>\n<li><p>使用未携带数据的DBD包进行主从关系选举</p>\n</li>\n<li><p>使用携带数据的DBD包共享数据库摘要信息</p>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>最大传输单元（MTU）</td>\n<td>发送接口所支持的MTU值，华为设备默认不检测MTU值</td>\n</tr>\n<tr>\n<td>I</td>\n<td>init，该位置为1，是一个进行主从选举的数据包</td>\n</tr>\n<tr>\n<td>M</td>\n<td>more，该位置为1，则代表这个DBD包后面还有其他的DBD包需要发送</td>\n</tr>\n<tr>\n<td>MS</td>\n<td>master，该位置为1，则代表发送这个数据包的设备为主</td>\n</tr>\n<tr>\n<td>DD 序列号</td>\n<td>在DBD报文中，会逐次加1，用于确保DBD报文传输的有序性和可靠性（隐形确认）</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf mtu-enable   # 在接口中配置， 如果两边均开启MTU的检测，并且两边MTU值设定不同，则OSPF的邻居关系将卡在EXSTRAT状态</span><br></pre></td></tr></table></figure>\n\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221116093446084.png\" alt=\"image-20221116093446084\" style=\"zoom:67%;\" />\n</li>\n<li><p>Lsr：链路状态请求报文（请求对方我不知道的）</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>链路状态类型，链路状态ID，通告路由器</td>\n<td>被称为是LSA的“三元组”，因为这三个参数可以标识出一条唯一的LSA信息</td>\n</tr>\n</tbody></table>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221116103800870.png\" alt=\"image-20221116103800870\" style=\"zoom:67%;\" />\n</li>\n<li><p>Lsu：链路状态更新报文（返回我不知道的拓扑或者路由）</p>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221116104215238.png\" alt=\"image-20221116104215238\" style=\"zoom:67%;\" />\n</li>\n<li><p>Lsack：链路状态确认报文（保证可靠性）</p>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221116104236711.png\" alt=\"image-20221116104236711\" style=\"zoom:67%;\" /></li>\n</ol>\n</li>\n<li><h3 id=\"OSPF的7个状态机：（两个路由器的关系）\"><a href=\"#OSPF的7个状态机：（两个路由器的关系）\" class=\"headerlink\" title=\"OSPF的7个状态机：（两个路由器的关系）\"></a>OSPF的7个状态机：（两个路由器的关系）</h3><ol>\n<li><p><strong>Down</strong>：双方都不认识对方（A与B）</p>\n</li>\n<li><p><strong>init初始化</strong>：，B接收到hello包中（不包含自己的名字），B知道了A，B进入init状态</p>\n</li>\n<li><p><strong>2way双向通讯</strong>：B接收到hello包中（包含自己的名字），<strong>邻居关系建立</strong>的标志</p>\n<ul>\n<li>匹配条件：DR（一个路由器）&#x2F;BDR（备份路由器）选举</li>\n<li>条件匹配成功进入下一个状态，如果条件匹配失败，则停留在邻居关系，仅使用hello进行周期保活</li>\n</ul>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221114171642645.png\" alt=\"image-20221114171642645\" style=\"zoom:50%;\" />\n</li>\n<li><p><strong>Exstart预启动</strong>：使用不携带目录信息的DBD包，1.进行主从关系的选举；<strong>rid大为主</strong>，为主的可以优先获取LSA信息，解决了目录共享时的无序，避免了它们的同时更新；2.主方可以住到隐形确认，可以定义隐形确认中的序列号。</p>\n</li>\n<li><p><strong>Exchange准交换</strong>：使用携带目标信息的dbd包（谁的rid大先发送dbd包），共享本地数据库目录</p>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221114171753235.png\" alt=\"image-20221114171753235\" style=\"zoom:50%;\" />\n</li>\n<li><p><strong>loading加载</strong>：查看完邻接的dbd信息后，对比本地，然后基于本地未知的Lsa进行查询；使用lsr向对端查询，对端使<strong>用lsu来传输这些lsa信息</strong>，本地<strong>收到后需要lsack来进去确认</strong></p>\n</li>\n<li><p><strong>Full</strong>：<strong>邻接关系建立</strong>标志；意味着邻接间，数据库同步（一致）；邻接关系的设定是为了和之前邻居关系进行区分，邻居关系只是单纯的使用hello包进行保活，而只有邻接关系，才会发LSA信息</p>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221114171910510.png\" alt=\"image-20221114171910510\" style=\"zoom:50%;\" /></li>\n</ol>\n</li>\n<li><p>名词解释：</p>\n<ul>\n<li>邻居关系：邻居关系就是只交互过hello报文，并不知道邻居具体的Lsa</li>\n<li>邻接关系：就是两个邻居之间完成交互过各种报文，两台路由器拥有各自的明细拓扑信息Lsdb完全同步</li>\n<li>Lsdb：链路状态数据库，所有lsa的集合</li>\n<li>Lsa【货物】：链路状态通告，具体的一条一条拓扑或路由信息，基于LSU包进行共享（LSU运输）</li>\n</ul>\n</li>\n<li><p>结构突变：</p>\n<ul>\n<li>新增网段：触发更新– LSU和LSack 直接告知</li>\n<li>断开网段：触发更新– LSU和LSack 直接告知</li>\n<li>无法沟通：dead time为hello包的4倍；在4次周期内未收到对端的hello包，将断开与其邻居关系，删除通过该邻居计算所得路由</li>\n</ul>\n</li>\n<li><h3 id=\"OSPF的工作过程：\"><a href=\"#OSPF的工作过程：\" class=\"headerlink\" title=\"OSPF的工作过程：\"></a>OSPF的工作过程：</h3><ol>\n<li>启动配置完成后，OSPF向本地所有运行协议的接口以组播224.0.0.5的形式发送hello包，（包含本地的RID以及自己已知的邻居的RID）；之后，将收集到的邻居关系记录在一张表 — <strong>邻居表</strong></li>\n<li>之后需要关注条件，若不能建立为邻接，将保持为邻居关系，仅hello包周期保活</li>\n<li>若条件匹配可以建立邻接关系，先使用未携带数据库目录信息的DBD包来进行主从关系的选举，之后由主引导先后顺序使用携带目录信息的DBD包共享数据库目录</li>\n<li>之后本地基于其他设备的目录，判断由本地未知的LSA信息，再使用LSR&#x2F;LSU&#x2F;LSACK来通过邻接获取具体的LSA信息，完成本地的<strong>数据库表</strong>（LSDB链路状态数据库）</li>\n<li>本地数据库完整后，本地将基于数据库中的内容启动SPF算法，将数据库整理为有向图–&gt;最短路径树—-&gt;将本地到达所有未知网段的最短路径加载于本地的<strong>路由表</strong>中</li>\n<li>路由表建立完成，收敛结束，之后每<strong>10S</strong>使用<strong>hello</strong>包周期保活；每<strong>30min</strong>邻接间进行一次<strong>数据库目录核对</strong></li>\n</ol>\n</li>\n<li><h4 id=\"区域划分规则：\"><a href=\"#区域划分规则：\" class=\"headerlink\" title=\"区域划分规则：\"></a>区域划分规则：</h4><ol>\n<li><p>星型结构：编号0骨干区域（中心），大于0为非骨干区域（分支），非骨干区域必须直连骨干区域</p>\n</li>\n<li><p>必须存在ABR：区域边界路由器，骨干区域0与非骨干区域相连&gt;0的设备；区域之间可以存在多个ABR设备；一个ABR也可以连接多个区域</p>\n</li>\n</ol>\n</li>\n<li><p>区域ID：用来区分和标识OSPF的不同区域，32位二进制构成；也可以使用点分十进制表示，还可以直接使用十进制表示；其中，骨干区域的ID、必须设置为0。</p>\n</li>\n<li><h3 id=\"RID（路由器id）：\"><a href=\"#RID（路由器id）：\" class=\"headerlink\" title=\"RID（路由器id）：\"></a>RID（路由器id）：</h3><ul>\n<li><p>格式IPv4地址，可以区分和标定不同的路由器</p>\n</li>\n<li><p>32位二进制构成，全网唯一，格式统一（采用点分十进制的方式表示）</p>\n</li>\n<li><p>RID的获取方式：</p>\n<ol>\n<li><p>手工配置：</p>\n</li>\n<li><p>自动生成：1.优先选择环回接口中IP地址最大的作为RID，2.如果没有环回，则选择物理接口中IP地址最大的作为RID</p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li><p>基础配置：</p>\n<ol>\n<li><p>启动时定义进程号（配置模式，默认进程1）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num] router-id [路由器id]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>宣告接口地址（激活（可以收发OSPF的信息），被选中接口的拓扑信息可以共享给邻接，区域划分）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">area 0   # 先定义区域</span><br><span class=\"line\">network [接口IP地址] [反子网掩码]   </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查询ospf：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf peer   # 查看邻居关系表</span><br><span class=\"line\">display ospf peer brief   # 查看邻居简表</span><br><span class=\"line\">display ospf routing   # 查看路由器宣告的路由和学到路由</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf lsdb    # 查看LSDB</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip routing-table protocol ospf   # 查看ospf路由</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bandwidth-reference 1000    # 若修改带宽，全网需要一致（单位MB/s），先进入ospf</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><p>OSPF的开销值：</p>\n<ul>\n<li><p>OSPF <strong>cost&#x3D;参考带宽 &#x2F; 接口带宽</strong>，—– 华为体系下，默认参考带宽为100M</p>\n</li>\n<li><p>注意：开销值如果算出来是个小数，如果是大于1的小数，则直接取整数部分；如果是小于1的小数，直接取1。</p>\n</li>\n<li><p>OSPF优先cost值之和最小，为最佳路径；</p>\n</li>\n<li><p>若两条链路cost值之和相同，等开销负载均衡；若接口带宽大于参考带宽，cost为1，将可能导致选路不佳，建议修改默认的参考带宽</p>\n</li>\n</ul>\n</li>\n<li><p>扩展配置：</p>\n<ol>\n<li><p>DR（一个路由器）&#x2F;BDR（备份路由器）选举（有DR才有拓扑交换和lsa信息，才有路由）：</p>\n<ul>\n<li><p>在MA网络中，<strong>若所有的设备均为邻接关系，将出现大量的重复更新</strong>；所以，需要进行DR&#x2F;BDR的选举</p>\n</li>\n<li><p>邻居成为邻接关系的条件，与网络类型有关</p>\n</li>\n<li><p>网络类型：</p>\n<ul>\n<li>点到点：在一个网段内只能存在两个节点（串线链路）</li>\n<li>MA-多路访问：在一个网段内的节点数量不限制；不是当下连接了几个节点；而是该网络类型允许<strong>最终连接多个节点</strong>（以太网）</li>\n</ul>\n</li>\n<li><p>点到点网络邻居关系必成为邻接关系；</p>\n</li>\n<li><p>在MA网络中，将进行DR&#x2F;BDR选举；在一个<strong>网段</strong>中仅DR（大哥）&#x2F;BDR（二哥）与DRother其他路由器（小弟）为<strong>邻接关系</strong>，非DR&#x2F;BDR之间（小弟与小弟之间）为<strong>邻居关系</strong></p>\n<ul>\n<li><p>选举规则：</p>\n<ol>\n<li>先比较<strong>一个网段</strong>所有参选接口的优先级，默认优先级为1，取值范围0-255，越大越优；0标识不参选</li>\n<li>若优先级相同，比较参选设备的RID，数值大优</li>\n</ol>\n</li>\n<li><p>干涉选举：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf dr-priority 1   # 先进入这个参选接口</span><br></pre></td></tr></table></figure>\n\n<p>注：由于一个网段<strong>DR&#x2F;BDR选举</strong>需要消耗40S（<strong>选举时间 &#x3D;&#x3D; 死亡时间</strong>），故为保障网络的稳定性，选举是<strong>非抢占的</strong>；一旦一个网段选举完成后，再修改优先级除非设备重启，否则无法干涉到结果；若需要干涉选举时，可以重启所有设备的OSPF</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reset opsf process   # 重启ospf进程</span><br></pre></td></tr></table></figure>\n\n<p><strong>最终的方法时修改非DR&#x2F;BDR设备的优先级为0，代表不参选；不用重启进程</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf dr-priority 0   # 先进入这个参选接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>区域汇总：OSPF协议不支持接口汇总，只能在将A区域拓扑计算所得路由共享给B区域时进行汇总</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]</span><br><span class=\"line\">area [num]    # 进入区域的边界路由器配置</span><br><span class=\"line\">abr-summary [汇总后的IP地址] [子网掩码]</span><br><span class=\"line\">display ip routing-table protocol ospf   # 在另一个区域的路由器查看是否汇总</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>被动接口：仅接收不发送路由协议信息，用于连接用户终端的接口，不得用于建立邻接关系</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">silent-interface g0/0/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>认证：在直连邻居或者邻接的接口上配置，保障更新的安全</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf authentication-mode [加密算法] [编号] cipher [具体密码]    # 模式，编号，密码要求邻居间一致</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>加快收敛：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer hello [num]   # 先进入接口</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>邻居间计时器 10s hello time，40s dead time</li>\n<li>ospf要求直连邻居间hello time和dead time必须完全一致，否则无法建立邻居关系</li>\n<li>修改本地的hello time，本地的dead time自动4倍关系匹配</li>\n</ul>\n</li>\n<li><p>缺省路由：<strong>边界路由器上配置</strong>后，将自动向内网下方一条缺省路由，之后<strong>内网设备将自动生成缺省路由边界</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]</span><br><span class=\"line\">default-route-advertise always   </span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h3 id=\"2-HICP-OSPF\"><a href=\"#2-HICP-OSPF\" class=\"headerlink\" title=\"2.HICP-OSPF:\"></a>2.HICP-OSPF:</h3><ul>\n<li><p>OSPF的接口网络类型指：OSPF接口，在不同网络类型下，不同的工作方式</p>\n</li>\n<li><p>OSPF的接口网络类型：</p>\n<table>\n<thead>\n<tr>\n<th>网络类型</th>\n<th>OSPF接口的网络类型（工作方式）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>虚拟接口（环回）</td>\n<td>默认<strong>p2p</strong>，只是华为定义为P2P类型，实际没有数据收发，环回接口的开销值定义为0，环回接口默认学习32位的主机路由</td>\n</tr>\n<tr>\n<td>P2P（HDLC，PPP，GRE，MGRE）</td>\n<td>默认<strong>P2P</strong>，只能建立一个邻居关系，不选DR &#x2F; BDR；hello10S，dead time 40S</td>\n</tr>\n<tr>\n<td>BMA（以太网）</td>\n<td>默认<strong>Broadcast</strong>，可以建立多个邻居关系，需要进行DR和BDR选举，hello10S，dead time 40S</td>\n</tr>\n<tr>\n<td>没有真实网络环境对应</td>\n<td>默认<strong>P2MP</strong>（人工建立的），可以建立多个邻居关系，不需要进行DR和BDR选举，hello 30S，dead time 120S，可以学习邻居接口的主机路由（真实接口）；针对的是NBMA网络。</td>\n</tr>\n<tr>\n<td>NBMA（帧中继）</td>\n<td>NBMA ，可以建立多个邻居关系，需要进行DR和BDR选举，hello 30S，dead time 120S，<strong>只能手工建立邻居关系</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>Virtual，只有在</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>在OSPF中，如果双方的接口工作类型不一致，能否建立邻居关系取决于</p>\n<ul>\n<li>Router-id</li>\n<li>Area-id</li>\n<li>hello时间</li>\n<li>dead时间</li>\n<li>特殊区域标记位</li>\n<li>认证类型</li>\n</ul>\n</li>\n<li><p>查询接口的网络类型：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf interface [接口号]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改接口网络工作类型（中心站点和全连网状拓扑都需修改）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf network-type  broadcast  # 先进入接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意：</p>\n<ul>\n<li>华为体系下，隧道接口的传输速率被定义为64K（COST&#x3D;100M &#x2F; 64K &#x3D; 1562），实际无数据收发，其目的是为了让接口的开销值变得非常大，能不走就不走。</li>\n<li>走隧道接口实际还是需要从物理接口发出，但是会额外增加复杂的封装过程，造成资源浪费</li>\n</ul>\n</li>\n<li><p>拓扑结构：</p>\n<ul>\n<li><p>中心到站点（轴辐状，星型结构）：DR必须定在中心站点，没有BDR（修改分支站点优先级为0）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf dr-priority 0   # 先进入这个参选接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>部分网状结构，基于实际环境关注是否固定DR</p>\n</li>\n<li><p>全连网状结构：一种全连的MGRE环境（MESH），所有节点既是中心，也是分支；所有站点<strong>都将开启伪广播</strong>，这样将所有节点接口的<strong>网络类型改为 Broadcast</strong> 之后，所有节点在进行DR和BDR选举，将共同进行，则不会出现DR和BDR认知不统一的情况</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">分支站点之间互相注册</span></span><br><span class=\"line\">nhrp entry [Tunnel接口IP地址] [物理接口IP地址] register    # 配置其他分支站点的Tunnel地址，物理地址</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">分支站点都开启</span></span><br><span class=\"line\">nhrp entry multicast dynamic   </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>在NBMA环境下，<strong>双方都指定</strong>单播邻居来建立邻居关系</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">peer [对方接口IP地址]     # 先进入OSPF</span><br></pre></td></tr></table></figure>\n</li>\n<li><h3 id=\"OPSF的第八个状态机：\"><a href=\"#OPSF的第八个状态机：\" class=\"headerlink\" title=\"OPSF的第八个状态机：\"></a>OPSF的第八个状态机：</h3><ul>\n<li>Attempt（尝试 ，过渡状态）：出现在NBMA网络中，在  <strong>DOWN和INIT状态</strong>  之间，<strong>等待对端指定自己成为单播邻居</strong>，一旦指定后，将立即进入下一个状态</li>\n</ul>\n</li>\n<li><p>不规则区域：</p>\n<ul>\n<li>远离骨干的非骨干区域</li>\n<li>不直连骨干的区域</li>\n</ul>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221117170404300.png\" alt=\"image-20221117170404300\" style=\"zoom:80%;\" />\n</li>\n<li><p>不规则区域的解决方法：</p>\n<ol>\n<li><p>Tunnel：合法ABR和非法ABR间S建立Tunnel隧道，然后将Tunnel宣告在OSPF</p>\n<ul>\n<li><p>R2和R4直接需要建立邻居关系，所以，需要发送周期性的数据进行维护，造成中间通过链路的负担加重</p>\n</li>\n<li><p>可能造成重复更新</p>\n</li>\n<li><p>选路不佳（在OSPF中，路由器优先选择拓扑信息计算的路由）</p>\n</li>\n</ul>\n</li>\n<li><p>OSPF虚链路：非法ABR获取合法ABR的授权后，具有区域间路由共享的功能；合法ABR与非法ABR</p>\n<ul>\n<li><p><strong>虚链路永远属于区域0</strong></p>\n</li>\n<li><p>优点：没有新生链路，不存在选路问题</p>\n</li>\n<li><p>缺点：</p>\n<ul>\n<li>虚拟路只能穿越一个区域</li>\n<li>R2和R4直接需要建立邻居关系，所以，需要发送周期性的数据进行维护，造成中间通过链路的负担加重</li>\n</ul>\n</li>\n<li><p>非法ABR获取合法ABR的授权：双方路由器都需要配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在配置完成后，非法ABR将成为合法</span></span><br><span class=\"line\">vink-peer [对方路由器ID]    # 先进入合法ABR和非法ABR的区域</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看虚链路的详情</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf vlink</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><h3 id=\"多进程双向重发布：\"><a href=\"#多进程双向重发布：\" class=\"headerlink\" title=\"多进程双向重发布：\"></a>多进程双向重发布：</h3><ul>\n<li><p>因为不同的路由协议之间，堆路由的理解及运行逻辑都不相同，所以，不同的路由协议之间是存在信息隔离的</p>\n</li>\n<li><p>重发布：将不同方式（直连、静态、缺省、其他协议）的路由重发布进入RIP 、OSPF</p>\n</li>\n<li><p>重发布的定义：将本路由器上<strong>通过A协议学习并加表的路由</strong>以及<strong>通告到A协议接口对应的路由</strong>引入到B协议（除ODR ISIS）</p>\n</li>\n<li><p>注意：</p>\n<ol>\n<li><p>华为中不能将缺省路由重发布进入RIP协议（思科是可以的）</p>\n</li>\n<li><p>不能将缺省路由重发布进入OSPF协议（思科华为一致）</p>\n</li>\n</ol>\n</li>\n<li><p>ASBR设备（自治系统边界路由器）：能产生5类和7类LSA的路由器，处于OSPF区域和非OSPF区域之间的路由非OSPF协议的路由引入到OSPF的网络转中时</p>\n</li>\n<li><p>导入其他进程的路由信息（先将不规则区域写入另一个进程并导入）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import-route [其他协议名称] [其他进程号]   # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>导入的路由信息标记（代表域外的路由信息）：O_ASE</p>\n<ul>\n<li>路由信息的可控性较低，信任程度较低</li>\n<li>优先级<strong>默认设置为150</strong></li>\n</ul>\n</li>\n<li><p>重发布的分类：</p>\n<ul>\n<li>重发布点：单点 双点 多点</li>\n<li>重发布向：单向 双向 多向（协议1给协议2，协议2给协议3即为多向）</li>\n</ul>\n</li>\n<li><p>在进行多点 多向重发布时，会出现严重的网络问题：</p>\n<ol>\n<li>次优路径（原因是不同的路由协议AD值不同，以及计算metric值的方式不同）做双点双向重发布必定有次有路径</li>\n<li>路由环路（原因：路由回馈）路由回馈是原本RIP的路由重发布到了OSPF，但由于OSPF比RIP的优先级高，另一个边界路由器又重发布到了RIP中</li>\n</ol>\n</li>\n<li><h3 id=\"解决思路：\"><a href=\"#解决思路：\" class=\"headerlink\" title=\"解决思路：\"></a>解决思路：</h3><ol>\n<li>路由环路 ：解决路由回馈（保证所有进行重发布的路由器上路由是正确的）</li>\n<li>次优路经：根据不同的路由协议选路规则进行次优路径的调整（策略列表）</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"3-LSA头部内容：\"><a href=\"#3-LSA头部内容：\" class=\"headerlink\" title=\"3.LSA头部内容：\"></a>3.LSA头部内容：</h3><ul>\n<li><p>LSA链路状态通告：是OSPF在不同网络环境下用于携带和传递不同的信息</p>\n</li>\n<li><p>LSDB： 链路状态据库</p>\n</li>\n<li><p>查看LSDB</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf lsdb  </span><br><span class=\"line\">display ospf lsdb [LSA类型] [LinkState ID]   # 精准查看</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>LSA头部内容：</p>\n<p>链路状态类型，链路状态ID，通告路由器  被称为是LSA的<strong>三元组</strong>，因为这三个参数可以标识出一条唯一的LSA信息</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Type</td>\n<td><strong>LSA的类型</strong>， 在 OSPFV2 当中，需要具体掌握6中LSA</td>\n</tr>\n<tr>\n<td>LinkState ID</td>\n<td><strong>链路状态标识符</strong>，是一个LSA的名称，这个参数在不同的LSA类型中将携带不同的信息</td>\n</tr>\n<tr>\n<td>AdvRouter</td>\n<td><strong>通告路由器</strong>，发出的LSA的路由器RID</td>\n</tr>\n<tr>\n<td>LS AGE</td>\n<td><strong>LSA的老化时间</strong>1800s&#x3D;周期更新时间30min，当一条LSA被始发路由器产生时置为0，之后该LSA在网络种传播，老化时间也会持续累加；当一条LSA的老化时间到达3600s时（最大老化时间）则将会从LSDB数据库中删除</td>\n</tr>\n<tr>\n<td>LEN</td>\n<td><strong>长度</strong> ，表示LSA的内容所占的字节数</td>\n</tr>\n<tr>\n<td>Options</td>\n<td><strong>标记位</strong>，Virtual：代表该路由器是V-LINK（虚链路）的一个端点；ASBR：代表该路由器为ASBR设备；ABR：代表该路由为ABR设备；E：代表特殊区域</td>\n</tr>\n<tr>\n<td>SEQ</td>\n<td><strong>序列号</strong>，本质是由32位二进制构成，一台路由器每发送同一条LSA时都会携带一个序列号，且逐次加1</td>\n</tr>\n<tr>\n<td>CHKsum</td>\n<td><strong>效验盒</strong>，也会参与新旧关系的比较，如果两条相同的LSA其序列号也相同，则将比较效验和，效验和大的判定为新</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>序列号空间：（SEQ序列号内容）</p>\n<ul>\n<li><p>直线型空间：从最小值到最大值逐次加1</p>\n<ul>\n<li>优点：新旧关系容易区分，数字大绝对比数字小的新</li>\n<li>缺点：一旦序列号空间用尽，新旧关系不好区分</li>\n</ul>\n</li>\n<li><p>循环型空间：从最小值到最大值在继续循环</p>\n<ul>\n<li>优点：序列号可以一致使用</li>\n<li>缺点：当两个序列号差值较大时，新旧关系不好区分</li>\n</ul>\n</li>\n<li><p>棒棒糖型空间：</p>\n<ul>\n<li>OSPF采用的就是这种序列号空间</li>\n<li>为了避免循环型空间的缺点OSPF要求<strong>不能进入循环部分</strong>（还是直线），所以，取值为 0X80000001 - 0X7FFFFFFX</li>\n<li>当序列号达到最大值时，始发设备会将该LSA的老化时间设置为最大老化时间，之后发出，其他收到该LSA的设备因为其序列号值最大，将刷新本地LSDB数据库，之后，又因为该LSA老化时间为最大老化时间，将把该LSA信息删除。同时，始发设备会再发送一条相同的LSA，其序列号为0X80000001，之后，其他设备将该LSA信息收集入库，起到刷新序列号空间的效果</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4-LSA的6种分类：\"><a href=\"#4-LSA的6种分类：\" class=\"headerlink\" title=\"4.LSA的6种分类：\"></a>4.LSA的6种分类：</h3><table>\n<thead>\n<tr>\n<th>类</th>\n<th>分类</th>\n<th>LinkState ID</th>\n<th>通告路由器</th>\n<th>传播范围</th>\n<th>携带信息</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Router</td>\n<td>通告者的RID</td>\n<td>本区域内运行通告者的RID</td>\n<td>单区域</td>\n<td>通告者路由器接口直连的拓扑信息</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Network</td>\n<td>DR的IP地址</td>\n<td>MA网络中DR所在的路由器的RID</td>\n<td>单区域</td>\n<td>单个网络网段的拓扑补充信息</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Sum-Net（summary）</td>\n<td>目标路由网洛</td>\n<td>ABR<strong>边界路由器RID</strong>，在通过下一个ABR时，将修改为新的ABR</td>\n<td>ABR相邻的单区域</td>\n<td><strong>域间路由信息</strong></td>\n</tr>\n<tr>\n<td>4</td>\n<td>Sum-Asbr（asbr）</td>\n<td>ASBR的RID</td>\n<td>ASBR所在区域的ABR设备，在通过下一个ABR设备时，将修改为新的ABR</td>\n<td>除了ASBR所在区域的单区域</td>\n<td>ASBR的位置</td>\n</tr>\n<tr>\n<td>5</td>\n<td>External（ase）</td>\n<td>目标路由网洛</td>\n<td>ASBR-RID</td>\n<td>整个OSPF区域</td>\n<td><strong>域外路由信息（不规则区域路由）</strong></td>\n</tr>\n<tr>\n<td>7</td>\n<td>NSSA</td>\n<td>目标路由网洛</td>\n<td>ASBR-RID，离开NSSA区域后将被转换成5类LSA</td>\n<td>单个NSSA区域</td>\n<td><strong>域外路由信息</strong></td>\n</tr>\n</tbody></table>\n<ol>\n<li><h3 id=\"Router类型：\"><a href=\"#Router类型：\" class=\"headerlink\" title=\"Router类型：\"></a>Router类型：</h3></li>\n</ol>\n<ul>\n<li><p>每一条LINK都是在<strong>描述路由器接口的连接情况</strong>，<strong>一个接口可以使用多个LINK来进行描述</strong></p>\n</li>\n<li><p>区域内的启动OSPF的路由器只发一条Router类型的LSA</p>\n</li>\n<li><p>字段和对应的属性值：</p>\n<table>\n<thead>\n<tr>\n<th>Link Type</th>\n<th>Link ID</th>\n<th>Date</th>\n<th>metric</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Point-to-Point</td>\n<td>邻居的Router ID</td>\n<td>该网络上本地接口的IP地址</td>\n<td>开销值</td>\n</tr>\n<tr>\n<td>TransNet（DR与本设备）</td>\n<td>DR的接口IP地址</td>\n<td>该网段上本地接口的IP地址</td>\n<td>开销值</td>\n</tr>\n<tr>\n<td>StubNet（网络末端）</td>\n<td>该Stub网段的IP网络地址</td>\n<td>该Stub网段的网络掩码</td>\n<td>开销值</td>\n</tr>\n<tr>\n<td>Virtual</td>\n<td>虚连接邻居的Router ID</td>\n<td>去往该虚连接邻居的本地接口的IP地址</td>\n<td>开销值</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n  <img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221117191641331.png\" alt=\"image-20221117191641331\"  />\n\n<ul>\n<li><p>报文格式：</p>\n<table>\n<thead>\n<tr>\n<th>字段名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>V</td>\n<td>置1，代表该路由器是V-LINK的一个端点</td>\n</tr>\n<tr>\n<td>E</td>\n<td>置1，代表该路由器为ASBR设备</td>\n</tr>\n<tr>\n<td>B</td>\n<td>置1，代表该路由为ABR设备</td>\n</tr>\n</tbody></table>\n<img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221118194444658.png\" alt=\"image-20221118194444658\" style=\"zoom:80%;\" /></li>\n</ul>\n<ol start=\"2\">\n<li><h3 id=\"Network类型：\"><a href=\"#Network类型：\" class=\"headerlink\" title=\"Network类型：\"></a>Network类型：</h3></li>\n</ol>\n<ul>\n<li>在MA网络环境下，仅依靠1类LSA无法获取完整的拓扑信息，所以，我们引入了2类LSA，对拓扑信息进行<strong>补充说明</strong></li>\n<li>二类LSA所补充的都是一些公共信息，所以<strong>一个MA网络</strong>中只需要<strong>一台设备发送</strong>就可以了（DR发出）。</li>\n<li>补充内容：MA网段的子网掩码，MA网段中所连接的设备RID</li>\n</ul>\n  <img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221117191507891.png\" alt=\"image-20221117191507891\"  />\n\n<ul>\n<li><h2 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h2><ol>\n<li>1类和2类LSA传递的是<strong>拓扑信息</strong>，而其余的LSA传递的是<strong>路由信息</strong></li>\n<li>传递路由信息的LSA需要经过1类和2类LSA的验算才能使用。 例：需要通过1类和2类LSA找到通告者的位置</li>\n</ol>\n</li>\n</ul>\n<ol start=\"3\">\n<li><h3 id=\"Sum-Net类型：（域内路由信息，不规则区域路由）\"><a href=\"#Sum-Net类型：（域内路由信息，不规则区域路由）\" class=\"headerlink\" title=\"Sum-Net类型：（域内路由信息，不规则区域路由）\"></a>Sum-Net类型：（域内路由信息，不规则区域路由）</h3></li>\n</ol>\n<ul>\n<li>传递的是路由信息，由ABR设备通告，使用目标网络号作为LS ID</li>\n<li>携带内容：<ul>\n<li>目标网段的子网掩码</li>\n<li>开销值是通告者<strong>到达目标网段的开销值</strong></li>\n</ul>\n</li>\n</ul>\n  <img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221117191534811.png\" alt=\"image-20221117191534811\"  />\n\n<ol start=\"4\">\n<li><h3 id=\"Sum-Asbr类型（ASBR的位置）：\"><a href=\"#Sum-Asbr类型（ASBR的位置）：\" class=\"headerlink\" title=\"Sum-Asbr类型（ASBR的位置）：\"></a>Sum-Asbr类型（ASBR的位置）：</h3></li>\n</ol>\n<p>  <img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221118111422188.png\" alt=\"image-20221118111422188\"></p>\n<ol start=\"5\">\n<li><h3 id=\"External类型（域外路由信息）：\"><a href=\"#External类型（域外路由信息）：\" class=\"headerlink\" title=\"External类型（域外路由信息）：\"></a>External类型（域外路由信息）：</h3></li>\n</ol>\n<ul>\n<li><p>Metric字段的值因为<strong>不同路由协议对开销值的评判标准不同</strong>，所以在进行重发布时，无法直接使用其原先的开销值</p>\n</li>\n<li><p>我们在重发布后将舍弃原先的开销值，而重新赋予其一个规定的初始值seed metric（种子度量值，默认为1）</p>\n</li>\n<li><p>方法2：修改某协议进程的种子度量值：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deafult cost [num]    # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>方法1：在重发布过程中修改种子度量值： （方法二优先与方法一生效）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import-route [其他协议名称] [进程号] cost [开销值]   # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display [协议名] [协议号] database</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p>参数E type：标志位，标志着开销值的类型</p>\n<table>\n<thead>\n<tr>\n<th>字段取值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>所有OSPF网络内设备到达域外目标网段的开销值都 &#x3D;&#x3D; 种子度量值加沿途累加开销值</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>5类LSA默认的开销值</strong>，所有OSPF网络内设备到达域外目标网段的开销值都 &#x3D;&#x3D; 种子度量值</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>修改默认某协议进程的默认种子度量值</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">default type [num]      # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>方法2：在重发布过程中修改开销值类型：（E type）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import-route [其他协议名称] [进程号] type [类型号]   # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>参数Forwarding Address： 转发地址</p>\n<ul>\n<li>主要是为了应对选路不佳的情况</li>\n<li><strong>不存在选路不佳</strong>的情况：则将<strong>使用0.0.0.0进行填充</strong>，无实质性作用</li>\n<li><strong>存在选路不佳</strong>的情况，则将会把<strong>最佳选路填写在本字段</strong>，之后设备到达目标网段会查找到达FA地址的路径，而不会按照算法再去找通告路由器</li>\n</ul>\n</li>\n<li><p>参数Tag：路由标记</p>\n<ul>\n<li><p>主要是给路由信息打标记，方便后面流量的抓取，默认取值为1</p>\n</li>\n<li><p>配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import-route [其他协议名称] [进程号] tag [num]   # 先进入协议进程</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<p>  <img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221118104406226.png\" alt=\"image-20221118104406226\"></p>\n<ol start=\"6\">\n<li><h3 id=\"NSSA类型（域外路由信息）：\"><a href=\"#NSSA类型（域外路由信息）：\" class=\"headerlink\" title=\"NSSA类型（域外路由信息）：\"></a>NSSA类型（域外路由信息）：</h3></li>\n</ol>\n<ul>\n<li><p>参数Forwarding Address： 转发地址</p>\n<ul>\n<li><strong>默认</strong>使用<strong>ASBR</strong>设备<strong>环回</strong>接口的<strong>IP地址</strong>作为转发地址</li>\n<li><strong>不存在</strong>环回接口，则将使用ASBR的<strong>物理接口</strong>的IP地址作为转发地址</li>\n<li>收到这条LSA的设备，访问目标网段将直接将数据包发送到转发地址上</li>\n</ul>\n</li>\n<li><p>参数options：</p>\n<table>\n<thead>\n<tr>\n<th>options字段取值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>E</td>\n<td>置1：代表支持5类LSA；置0：代表特殊区域</td>\n</tr>\n<tr>\n<td>N</td>\n<td>置0：不在NSSA区域中；置1：在NSSA区域中</td>\n</tr>\n<tr>\n<td>P</td>\n<td>置1：代表该LSA支持7转5</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>7类LSA生成的路由信息其标记为O_NSSA，优先级也是150。</p>\n</li>\n</ul>\n<h3 id=\"5-OSPF的优化：\"><a href=\"#5-OSPF的优化：\" class=\"headerlink\" title=\"5.OSPF的优化：\"></a>5.OSPF的优化：</h3><ul>\n<li><p>主要指减少OSPF中的LSA更新量</p>\n</li>\n<li><h3 id=\"汇总：为了减少骨干区域的更新量\"><a href=\"#汇总：为了减少骨干区域的更新量\" class=\"headerlink\" title=\"汇总：为了减少骨干区域的更新量\"></a>汇总：为了减少骨干区域的更新量</h3><ul>\n<li><p>OSPF协议<strong>不支持接口汇总</strong>，只能在将A区域拓扑计算所得路由共享给B区域时进行汇总</p>\n</li>\n<li><p>域内汇总：区域之间在传递三类LSA时进行汇总，减少3类LSA的更新量</p>\n<ul>\n<li><p>配置：（在ABR设备上）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">abr-summary [汇总后的IP地址] [子网掩码]   # 先进入汇总前的区域</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意：域间路由汇总只能是一台ABR设备将自己通过1类和2类LSA学习到的路由信息汇总成一条3类LSA发送</p>\n</li>\n</ul>\n</li>\n<li><p>域外汇总（汇总不规则区域路由）：主要针对5类 &#x2F; 7类LSA进行汇总</p>\n<ul>\n<li><p>配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">asbr-summary [汇总后的IP地址] [子网掩码]   # 先进入在ASRB上的ospf进程,传递汇总路由的进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>域外汇总网段的度量值：</p>\n<table>\n<thead>\n<tr>\n<th>External分类中E type字段取值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>将选择所有明细路由中开销值最大的作为汇总网段的度量值（metric）</td>\n</tr>\n<tr>\n<td>2</td>\n<td>将选择所有明细路由中开销值最大+1 作为汇总网段的度量值（metric）</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><h3 id=\"做特殊区域：为了减少非骨干区域的LSA更新量\"><a href=\"#做特殊区域：为了减少非骨干区域的LSA更新量\" class=\"headerlink\" title=\"做特殊区域：为了减少非骨干区域的LSA更新量\"></a>做特殊区域：为了减少非骨干区域的LSA更新量</h3><ul>\n<li><p>第一大类的特殊区域（末梢区域 stub）：</p>\n<ul>\n<li><p>特点：</p>\n<ol>\n<li>不能是骨干区域（0区域）</li>\n<li>不能存在虚链路</li>\n<li>不能存在ASBR设备（自治系统边界路由器）</li>\n</ol>\n</li>\n<li><p>如果将一个区域配置成为<strong>末梢区域</strong>，则这个区域将<strong>拒绝学习4类和5类LSA</strong>（拒绝学习域外信息）</p>\n</li>\n<li><p>为了保证可以正常访问到域外的网段，末梢区域会自动生成一条指向骨干的3类缺省（通过3类LSA生成的缺省路由）。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stub    # 先进入本区域，区域内所有设备都必须配置；约等于缺省路由</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>普通的末梢区域改变成 完全末梢区域（Totally stub) ：在拒绝4类和5类LSA的基础上，进一步拒绝3类LSA但是保留3类缺省</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stub no-summary      # 先进入本区域，只需要在ABR设备上配置即可；约等于缺省路由</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>第二大类特殊区域（非完全末梢区域 NSSA）：</p>\n<ul>\n<li><p>特点：</p>\n<ol>\n<li>不能是骨干区域（0区域）</li>\n<li>不能存在虚链路</li>\n<li>必须存在ASBR设备（自治系统边界路由器）</li>\n</ol>\n</li>\n<li><p>如果将一个区域配置成为<strong>NSSA</strong>，则这个区域将<strong>拒绝学习4类和5类LSA</strong>（拒绝学习域外信息） </p>\n</li>\n<li><p>7类LSA（NSSA）：为了实现导入域外路由信息，NSSA区域又拒绝学习其他方向的4类和5类LSA的效果</p>\n</li>\n<li><p>为了保证可以正常访问到域外的网段，所以，NSSA区域会自动生成一条指向骨干的七类缺省（通过7类LSA生成的缺省，指向其他方向的域外路由）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nssa    # 先进入本区域，区域内所有设备都必须配置；约等于缺省路由</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>普通非完全末梢区域改变成 完全的非完全末梢区域 （Totally NSSA） ：在拒绝4类和5类LSA的基础上，进一步拒绝三类LSA。并自动生成一条指向骨干区域的3类缺省</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nssa no-summary    # 先进入本区域，仅需在ABR设备上配置即可；约等于缺省路由</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p><strong>OSPF的附录E</strong>：OSPF针对3类或5类&#x2F;7类在某些特定情况下的解决方案</p>\n<ul>\n<li><p>图示：</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221118202148049.png\" alt=\"image-20221118202148049\"></p>\n</li>\n<li><p>图中20.1.0.0&#x2F;16网段和20.1.0.1&#x2F;24网段在通过R3传递三类LSA（Sum-Net）时，他们的链路状态类型，链路状态ID，通告路由器完全相同</p>\n</li>\n<li><p>因为链路状态类型，链路状态ID，通告路由器  被称为是LSA的<strong>三元组</strong>，因为这三个参数可以标识出一条唯一的LSA信息</p>\n</li>\n<li><p>所以，为了避免三元组完全相同，导致无法区分两条不同的LSA，则附录E要求，<strong>掩码长度较长</strong>网段的LSA信息将使用<strong>目标网段的直接广播</strong>地址作为LS ID；例：20.1.0.255&#x2F;24。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"6-HICP-OSPF扩展配置：\"><a href=\"#6-HICP-OSPF扩展配置：\" class=\"headerlink\" title=\"6.HICP-OSPF扩展配置：\"></a>6.HICP-OSPF扩展配置：</h3><ul>\n<li><p>缺省路由：</p>\n<ul>\n<li><p>3类缺省：只能通过特殊区域（普通STUB，完全STUB，完全NSSA）的配置完成</p>\n</li>\n<li><p>5类缺省：通过配置命令生成，将域外的路由信息重发布到OSPF中</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]</span><br><span class=\"line\">default-route-advertise     # 将设备上其他途径获取的缺省信息重发布到OSPF网络上，一般在区域的边界路由器上</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]                         # 一般在区域的边界路由器上        </span><br><span class=\"line\">default-route-advertise always     # 如果设备本身不存在缺省信息，则可以通过后面增加always参数来强制下发一条缺省</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>7类缺省：可以通过配置特殊区域（普通的NSSA）自动生成，也可以通过配置手工配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nssa deafult-route-advertise    # 先进入本区域，在区域的NSDR路由器上配置，区域中的路由器全生成一条指向NSDR的缺省</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>手工认证：OSPF邻居间发送数据包中携带口令，两边如果口令相同，则身份合法</p>\n<ul>\n<li><p>接口认证： 模式，编号，密码要求邻居间一致,否则影响邻居的建立</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf authentication-mode [加密算法] [编号] [cipher/plain] [具体密码]      # 先进入接口</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">双端的密钥存储形式可以不同[cipher/plain]</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>区域认证：本质还是接口认证，在一个区域中配置区域认证，效果等于同时在这个区域中<strong>所有激活的接口上配置了接口认证</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">authentication-mode [加密算法] [编号] [cipher/plain] [具体密码]    # 先进入本区域，本区域的所有路由器上配置</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>​         虚链路认证：虚链路建立过程中的认证</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入合法ABR和非法ABR的区域，再建立虚链路的同时配置</span></span><br><span class=\"line\">vlink-peer [对方路由器ID] [加密算法] [编号] [cipher/plain] [具体密码]    </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>加快收敛：减少计时器的时间</p>\n<ul>\n<li><p>查看计时器时间</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf interface [接口号]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改hello时间：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer hello [num]    # 先进入接口</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">邻居间计时器 10s hello time，40s dead time</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ospf要求直连邻居间hello time和dead time必须完全一致，否则无法建立邻居关系</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改本地的hello time，本地的dead time自动4倍关系匹配</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改死亡时间：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer dead [num]    # 先进入接口</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">邻居间计时器 10s hello time，40s dead time</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ospf要求直连邻居间hello time和dead time必须完全一致，否则无法建立邻居关系</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改本地的dead time，本地的hello time不会改变，会改变等待时间（<span class=\"built_in\">wait</span> time）</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Waiting time：</p>\n<ul>\n<li><strong>等待时间 &#x3D;&#x3D; 死亡时间</strong>，DR&#x2F;BDR选举时间。</li>\n<li>修改死亡时间：该计时器时间会同步修改。</li>\n<li>注意，两个计时器分开计时，只是数值长短相同</li>\n</ul>\n</li>\n<li><p>Poll：轮询时间120S，与状态为DOWN的邻居关系发送hello包的间隔时间</p>\n</li>\n<li><p>NBMA环境下单方面指定邻居后，将邻居置为Attempt状态，等待对方指定自己。如果对方一直没有指定（120S，这个时间内会以30S为周期发送hello包）会将邻居的状态改为down状态，之后，将按照poll时间为周期发送hello包。</p>\n</li>\n<li><p>修改轮询时间：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer poll [num]    # 先进入接口，单位分钟second</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Retransmit：重传时间 5S，发送信息时需要确认；如果重传时间内没有收到确认信息，则将重传</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer retransmit [num]   # 先进入接口，单位分钟second</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Transmit Delay：传输延迟1S ，主要是附加在LSA的老化时间上的，为了补偿传输过程中消耗的时间</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf trans-delay [num]   # 先进入接口，单位分钟second</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>沉默接口：将一个接口设置称为沉默接口，他将只接受不发送OSPF的数据包</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">silent-interface g0/0/0   # 先进入ospf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>路由过滤：主要是针对3类，5类，7类LSA进行过滤</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">过滤3类LSA，先进入需要过滤网段的区域，不让此网段发网其他区域</span></span><br><span class=\"line\">abr-summary [需要过滤掉的IP网段] [子网掩码] not-advertise   </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">过滤5类/7类LSA，先进入NSSA区域</span></span><br><span class=\"line\">asbr-summary [需要过滤掉的IP网段] [子网掩码] not-advertise   </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>路由控制：</p>\n<ul>\n<li><p>优先级：</p>\n<ul>\n<li><p>修改类型为OSPF路由（通过1类，2类和3类LSA学到的）的默认优先级</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">preference [num]    # 先进入OSPF进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改类型为O_ASE &#x2F; O_NSSA的路由（通过5类和7类学到的）的默认优先级</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">preference ase [num]   # 先进入OSPF进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>注意：这条命令在修改的只能影响本设备，并且将本设备上所有对应协议类型的路由条目优先级统一修改</p>\n</li>\n</ul>\n</li>\n<li><p>开销值COST：参考带宽 &#x2F; 真实带宽，华为体系下，默认参考带宽为100M</p>\n<ul>\n<li><p>通过修改参考带宽达到修改开销值得目的</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bandwidth-reference [num]    # 全网需要一致（单位MB/s），先进入ospf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>通过修改真实带宽达到修改开销值得目的（修改后需要重启接口后生效）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spend [10/100/1000]   # 修改接口得传输速率，先进入接口</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">undo negotiation auto   # 关闭自动协商，先进入接口</span><br></pre></td></tr></table></figure>\n\n<p>注意：这种方法确实可以起到控制选路的效果，但是，因为只能把接口的传输速率改低，所以，会影响链路的传输效率，不建议使用</p>\n</li>\n<li><p>直接修改接口的开销值：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf cost [num]    # 先进入接口</span><br></pre></td></tr></table></figure>\n\n<p>注意：如果一条链路两端接口的开销值大小不一样，则我们将按照路由传递方向的入接口（数据传输的出接口）的开销值来计算</p>\n</li>\n<li><p><strong>查看接口开销值：</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf interface [接口号]</span><br></pre></td></tr></table></figure>\n\n<p>注意：</p>\n<ul>\n<li>如果一条链路两端接口的开销值大小不一样，则我们将<strong>按照路由传递方向的入接口</strong>（数据传输的出接口）的开销值来计算</li>\n<li>如果想要<strong>改变到达某一个末梢网段的开销值</strong>，建议直接在这个<strong>修改这个末梢网段接口的开销值</strong>，而<strong>不要修改沿途骨干链路的开销值</strong>。因为沿途修改则经过的路由的开销都会影响。</li>\n<li>路由层面（控制层面）：路由协议传递路由信息产生的流量</li>\n<li>数据层面：设备访问目标地址时产生的数据流量</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"7-OSPF的选路原则：\"><a href=\"#7-OSPF的选路原则：\" class=\"headerlink\" title=\"7.OSPF的选路原则：\"></a>7.OSPF的选路原则：</h3><ul>\n<li><p>域内：1类LSA，2类LSA</p>\n<ul>\n<li>两条到达相同目标的路由，直接比较开销值，若两边开销值相同，则负载均衡</li>\n</ul>\n</li>\n<li><p>域间：3类LSA</p>\n<ul>\n<li>两条到达相同目标的路由，直接比较开销值，若两边开销值相同，则负载均衡</li>\n</ul>\n</li>\n<li><p>域外：5类LSA，7类LSA </p>\n<ul>\n<li><p>参数E type：类型1：直接比较总度量值（种子度量+沿途累加开销值），优选总度量小的；如果总度量相同，则负载均衡</p>\n</li>\n<li><p>参数E type：类型2：先比较种子度量值，优选种子度量值小的；如果种子度量值相同，则比较沿途累加开销值，优先选择沿途累加开销值小的；如果都相同，则负载均衡</p>\n</li>\n<li><p><strong>类型1永远优于类型2</strong></p>\n</li>\n<li><p>同时查看所有5类LS</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf lsdb ase</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>域内和域间：域内路由优于域间路由，即使域内路由开销值巨大</p>\n</li>\n<li><p>域间和域外：域间路由优于域外路由，即使域间路由开销值巨大</p>\n</li>\n<li><p>5类和7类LSA：在华为体系中，5类和7类LSA生成的路由信息在优先级比较方面没有区别</p>\n</li>\n</ul>\n<h3 id=\"8-OSPF的防环：\"><a href=\"#8-OSPF的防环：\" class=\"headerlink\" title=\"8.OSPF的防环：\"></a>8.OSPF的防环：</h3><ul>\n<li>域内防环：<ul>\n<li>星型区域划分本身就是一种防环的手段</li>\n<li>区域之间需要遵循区域水平分割机制，即从哪个区域学来路由的就不再发回到那个区域</li>\n</ul>\n</li>\n<li>域间防环：SPF最短路径优先算法，有向图–&gt;最短路径树—-&gt;路由</li>\n</ul>\n<h2 id=\"4-路由策略：\"><a href=\"#4-路由策略：\" class=\"headerlink\" title=\"4.路由策略：\"></a>4.路由策略：</h2><ul>\n<li>通过调整路由中的一些属性调整路由（控制层面）</li>\n</ul>\n<h3 id=\"1-路由抓取工具列表：\"><a href=\"#1-路由抓取工具列表：\" class=\"headerlink\" title=\"1.路由抓取工具列表：\"></a>1.路由抓取工具列表：</h3><ul>\n<li><p>ACL：访问控制列表， 抓取路由时丌能匹配网络掩码</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acl [id]</span><br><span class=\"line\">rule [permit/deny] source [IP地址] [通配符]</span><br><span class=\"line\">例：</span><br><span class=\"line\">\trule deny source 192.168.1.3 0.0.0.0   #拒绝一个IP地址</span><br><span class=\"line\">\trule deny source 192.168.2.0 0.0.0.255   #拒绝一个网段</span><br></pre></td></tr></table></figure>\n\n<p>通配符：0代表固定，1代表可变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">抓去1.1.1.0/24 - 1.1.255.0/24网段中的奇数网段和偶数网段</span></span><br><span class=\"line\">奇数网段：rule deny source 1.1.1.0  0.0.254.0 </span><br><span class=\"line\">偶数网段：rule deny source 1.1.0.0  0.0.254.0 </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Prefix-List：前缀列表</p>\n<ul>\n<li><p>特点：</p>\n<ol>\n<li>仅仅抓取路由信息</li>\n<li>能严格匹配网络掩码（以及可以范围性匹配掩码）</li>\n<li>存在序列号，从小到大匹配，一经匹配立即执行</li>\n<li>末尾隐含了拒绝所有</li>\n</ol>\n</li>\n<li><p>配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip ip-prefix [列表名] index [序列号] [deny/permit] [IP地址/IP网段] [网络号固定长度]</span><br><span class=\"line\">\t[greater-equal] [num]     # 大于等于num网络号长度</span><br><span class=\"line\">\t[less-equal] [num]        # 小于等于num网络号长度</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">定义前缀列表 cisco ，序列号20 ，过滤 1.1.1.0 前24位固定，网络掩码范围大于等于28 小于等于30</span></span><br><span class=\"line\">ip ip-prefix cisco index 20 deny 1.1.1.0 24 greater-equal 28 less-equal 30</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">匹配 所有的主机路由</span></span><br><span class=\"line\">ip ip-prefix c1 permit 0.0.0.0 0 greater-equal 32</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看前缀列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip ip-prefix [列表名] </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-实施策略工具列表：\"><a href=\"#2-实施策略工具列表：\" class=\"headerlink\" title=\"2.实施策略工具列表：\"></a>2.实施策略工具列表：</h3><ul>\n<li><p>Fitter-Policy ：过滤策略列表，进行路由信息的过滤</p>\n<ul>\n<li><p>特点：</p>\n<ol>\n<li>.自身不具备过滤功能 </li>\n<li>可以在<strong>同种路由之间使用</strong>或<strong>不同路由协议之间使用（重发布）</strong>过程中使用</li>\n<li>同种路由协议之间分为<ul>\n<li>距离矢量型（可以在出和入两个方向实施）</li>\n<li>链路状态型（仅仅在入方向使用，并且不是过滤LSA，只是阻止LSA的加表 ）</li>\n<li>备注： 华为设备中可以在出方向上针对5类和7类LSA进行过滤</li>\n</ul>\n</li>\n<li>在不用协议之间使用时，必须为export + A协议（需要被重发布的协议）</li>\n</ol>\n</li>\n<li><p>距离矢量型：可以在学习路由的Import（入），export（出）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filter-policy [列表类型] [列表名] [import/export] [接口/协议进程]   # 先进入协议进程</span><br><span class=\"line\">例：</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">filter-policy ip-prefix c2 import g0/0/1</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">filter-policy ip-prefix c2 rip 100</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>链路状态型：只能在学习路由的import 方向是实施，仅仅是阻止路由条目加表，不能过滤LSA </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filter-policy [序列号] import </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><h3 id=\"Route-Policy-：-策略列表\"><a href=\"#Route-Policy-：-策略列表\" class=\"headerlink\" title=\"Route-Policy ： 策略列表\"></a>Route-Policy ： 策略列表</h3><ul>\n<li><p>使用环境：</p>\n<ul>\n<li>重发布 </li>\n<li>BGP</li>\n<li>PBR（QOS，是数据层面的控制 ）</li>\n</ul>\n</li>\n<li><p>特点：</p>\n<ol>\n<li><p>自身具有过滤功能</p>\n</li>\n<li><p>序列号由小及大匹配</p>\n</li>\n<li><p>可以过滤路由或者改变路由的属性</p>\n</li>\n<li><p><strong>末尾隐含拒绝所有</strong></p>\n</li>\n<li><p>每一个条目中包含逻辑语句   if-match（如果匹配） apply（执行以下结果）</p>\n<ul>\n<li><p>if-match此一行后的条件为相似匹配  </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if-match acl 2000,2001,2002</span><br><span class=\"line\">apply cost=10000</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>if-match的条件竖的写为绝对匹配，必须满足所有条件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if-match</span><br><span class=\"line\">acl 2000</span><br><span class=\"line\">cost=20</span><br><span class=\"line\">route-tag 99</span><br><span class=\"line\">apply cost 20000</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>没有匹配all 没有apply apply nothing</p>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><p>创建策略列表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">route-policy [列表名] [deny/premit] node [序列号]   # 序列号只是列表的条数</span><br><span class=\"line\">if-match [条件] .....</span><br><span class=\"line\">apply [执行内容]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改符合前缀列表路由的开销值类型为1</span></span><br><span class=\"line\">route-policy os1 permit node 10</span><br><span class=\"line\">if-match ip-prefix b1</span><br><span class=\"line\">apply cost-type type-1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">修改符合前缀列表路由的开销值为+3</span></span><br><span class=\"line\">route-policy os1 permit node 10</span><br><span class=\"line\">if-match ip-prefix b1</span><br><span class=\"line\">apply cost + 3</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">过滤掉符合条件的路由网段</span></span><br><span class=\"line\">route-policy os1 deny node 20</span><br><span class=\"line\">if-match ip-prefix b1</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">放行符合条件的路由网段</span></span><br><span class=\"line\">route-policy os1 permit node 30</span><br><span class=\"line\">if-match ip-prefix b1</span><br></pre></td></tr></table></figure>\n\n\n</li>\n<li><p>调用策略列表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import-route [协议类型] [进程号] route-policy [列表名]    # 先进入协议进程</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看策略列表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display route-policy [列表名]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"5-策略路由：\"><a href=\"#5-策略路由：\" class=\"headerlink\" title=\"5.策略路由：\"></a>5.策略路由：</h2><ul>\n<li><p>通过工具对数据层面的转发方式进行调整（数据层面）</p>\n</li>\n<li><p>PBR（policy based router）： 基于策略的路由</p>\n</li>\n<li><p>本地PBR：针对本设备产生的流量进行策略控制</p>\n<ul>\n<li><p>只能使用acl抓取流量</p>\n</li>\n<li><p>创建本地PBR：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">方式1：</span></span><br><span class=\"line\">policy-based-route [列表名] [permit/deny] node [序列号]</span><br><span class=\"line\">if-match [条件]</span><br><span class=\"line\">apply ip-address next-hop [下一跳地址]     # 强制指定某网段或某些网段的下一跳</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">方式2：方式2需要开启对端接口的ARP代理</span></span><br><span class=\"line\">policy-based-route [列表名] [permit/deny] node [序列号]</span><br><span class=\"line\">if-match [条件]</span><br><span class=\"line\">apply output-interface [本地路由出接口号]     # 强制指定某网段或某些网段的路由出接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>调用RBR列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip local policy-based-route [列表名]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看PBR列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display policy-based-route</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>默认在华为设备中，三层接口的代理ARP 功能是关闭的，所以在本地的PBR中，需要开启对端的代理ARP功能，否则会因为学习不到对方的MAC导致数据不同</p>\n</li>\n<li><p>在对端的路由器开启接口的ARP代理（方式2才开启）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arp-proxy enable    # 先进入接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>接口PBR：针对非本设备产生的数据进行策略控制，华为中使用MQC 模型来实现接口级别的PBR</p>\n<ul>\n<li><p>只能使用acl抓取流量</p>\n</li>\n<li><p>使用MQC模型中的classifier</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traffic classifier [列表名]</span><br><span class=\"line\">if-match [条件]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用traffic behavior 定义策略（行为）（指定下一跳）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traffic behavior [列表名]</span><br><span class=\"line\">redirect ip-nexthop [下一跳地址]     # 强制指定某网段或某些网段的下一跳</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>定义traffic policy ，关联以上两个列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traffic policy [列表名]</span><br><span class=\"line\">classifier [列表名] behavior [列表名]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在流量进入的接口调用</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traffic-policy [列表名] inbound    # 先进入接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n","_path":"2023/03/19/1.网络基础/4.HCIP-网络类型GREOSPF/","_link":"https://example.com/2023/03/19/1.%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/4.HCIP-%E7%BD%91%E7%BB%9C%E7%B1%BB%E5%9E%8BGREOSPF/","_id":"clfgd5gds001c70q4cof94n9d"}}