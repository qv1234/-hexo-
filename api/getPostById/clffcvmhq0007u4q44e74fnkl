{"type":"getPostById","data":{"title":"HCIA-华为模拟器和，路由，控制列表，ACL","date":"2023-03-19T11:48:57.111Z","description":"","categories":[{"name":"网络","_id":"clffcvmhk0004u4q4het76o2o"}],"tags":[{"name":"网络","_id":"clffcvmhn0005u4q4au3o5v4z"}],"content":"<h2 id=\"1-华为模拟器：\"><a href=\"#1-华为模拟器：\" class=\"headerlink\" title=\"1.华为模拟器：\"></a>1.华为模拟器：</h2><h3 id=\"1-操作模式：\"><a href=\"#1-操作模式：\" class=\"headerlink\" title=\"1.操作模式：\"></a>1.操作模式：</h3><ul>\n<li><p>用户视图模式（第一级别模式，可以对设备进行所有的查看及测试）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Huawei&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置模式（第二级别模式，改名，设置密码等）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>专用配置模式（第三级别模式）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei-?????]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>专用配置模式（第四级别模式）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei-?????-?????]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>高级模式可以执行低级模式命令</p>\n</li>\n</ul>\n<h3 id=\"2-用户视图配置命令：\"><a href=\"#2-用户视图配置命令：\" class=\"headerlink\" title=\"2.用户视图配置命令：\"></a>2.用户视图配置命令：</h3><ul>\n<li><p>查看接口配置简介：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display interface brief</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Interface                   PHY   Protocol InUti OutUti   inErrors  outErrors</span><br><span class=\"line\">GigabitEthernet0/0/0        up    up          0%     0%          0          0</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">PHY（物理状态，通电即为up）</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">Protocol(协议，配置IP地址即为up)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>保存配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">save</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>重启设备：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reboot</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"3-配置模式：\"><a href=\"#3-配置模式：\" class=\"headerlink\" title=\"3.配置模式：\"></a>3.配置模式：</h3><ul>\n<li><p>查看当前配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display current-configuration</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置主机名</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如将[Huawei]改成[r1]</span></span><br><span class=\"line\">sysname [name]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置时间和时区：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clock datetime [YY:MM:TT]</span><br><span class=\"line\">clock timezone [时区名称] add [YY:MM:TT]   # 更改时区</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看时间和时区：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display clock</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看系统版本：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display version</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看路由表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip routing-table</span><br><span class=\"line\">display ip routing-table protocol [协议类型]   # 只查看其中一种协议的路由表</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看DHCP地址池：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip pool</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看DHCP获取报文情况</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display dhcp statistics\t</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"4-接口配置命令：\"><a href=\"#4-接口配置命令：\" class=\"headerlink\" title=\"4.接口配置命令：\"></a>4.接口配置命令：</h3><ul>\n<li><p>进入端口：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface ???Ethernet [端口号]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>undo取消此命令：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">undo shutdown # 开启端口</span><br><span class=\"line\">shutdown  # 关闭端口</span><br><span class=\"line\">undo ip address [IP地址] [网路地址长度/子网掩码]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置端口IP地址和子网掩码或网络号长度</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip address [IP地址] [网路地址长度/子网掩码]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看当前接口的所有配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display this</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"5-帮助命令：\"><a href=\"#5-帮助命令：\" class=\"headerlink\" title=\"5.帮助命令：\"></a>5.帮助命令：</h3><ul>\n<li>？：查看该模式或该单词后可以配置的命令及注解</li>\n<li>Tab键：自动补全单词</li>\n</ul>\n<h3 id=\"6-命令级别：\"><a href=\"#6-命令级别：\" class=\"headerlink\" title=\"6.命令级别：\"></a>6.命令级别：</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参观级：0，监控级：1，配置级：2，管理级：3级以上</span><br><span class=\"line\">用户等级：0-15</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"2-Telnet（用户）：\"><a href=\"#2-Telnet（用户）：\" class=\"headerlink\" title=\"2.Telnet（用户）：\"></a>2.Telnet（用户）：</h2><ul>\n<li><p>telnet是基于TCP协议的，端口号23</p>\n</li>\n<li><p>开启用户接口空间（先配置各接口IP地址）：写在被登录的设备 </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei]user-interface vty 0 4</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改认证模式为AAA</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">authentication-mode aaa</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>进入AAA接口模式</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei]aaa</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建本地用户及密码</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei-aaa]local-user huawei password cipher 123456</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改huawei用户的权限等级</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei-aaa]local-user huawei privilege level 15</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改huawei用户的服务类型为telnet</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei-aaa]local-user huawei service-type telnet</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>测试：连接telnet服务器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Telnet Client&gt;telnet 192.168.1.2</span><br><span class=\"line\">Press CTRL_] to quit telnet mode</span><br><span class=\"line\">Trying 192.168.1.2 ...</span><br><span class=\"line\">Connected to 192.168.1.2 ...</span><br><span class=\"line\"></span><br><span class=\"line\">Login authentication</span><br><span class=\"line\"></span><br><span class=\"line\">Username:huawei</span><br><span class=\"line\">Password:</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"3-DHCP服务：\"><a href=\"#3-DHCP服务：\" class=\"headerlink\" title=\"3.DHCP服务：\"></a>3.DHCP服务：</h2><ul>\n<li><p>基本概念：</p>\n<ul>\n<li><p>动态主机配置协议</p>\n</li>\n<li><p>C&#x2F;S架构：响应速度快</p>\n</li>\n<li><p>基于UDP，67&#x2F;68（68用于客户端，67、用于服务端）</p>\n</li>\n<li><p>报文类型：八种</p>\n<ol>\n<li>DHCP discover：客户端用于寻找DHCP服务器</li>\n<li>DHCP offer：DHCP服务器回复客户端的DISCOVER报文，该报文携带了网络参数</li>\n<li>DHCP request：客户端请求配置确认或续租</li>\n<li>DHCP ack：服务器对request确认</li>\n<li>DHCP nak：服务器对reqeust拒绝</li>\n<li>DHCP release：客户端请求释放地址</li>\n<li>DHCP decline：客户端用于检测IP地址冲突后，发送给服务器的</li>\n<li>DHCP inform：当客户端获取IP报文后，使用哦个此报文获取其他配置信息</li>\n</ol>\n</li>\n</ul>\n</li>\n<li><p>工作过程：</p>\n<ol>\n<li>客户机广播DHCP discover报文来发现当前网络中的DHCP服务器，并请求IP地址等相关信息<ul>\n<li>路由器收到这个数据帧后，先看二层，一看是广播帧，所以，解二层封装；</li>\n<li>将解开后的数据包发送给IP模块进行处理，IP模块需要先看目的IP地址，一看是受限广播地址，则解三层封装；</li>\n<li>因为U<strong>协议字段为17（UDP）</strong>，则交给UDP模块UDP模块进行处理</li>\n<li>之后依靠数据段中的目的<strong>端口号67（DHCP服务端）</strong>判断，交给对应的DHCP服务进行进一步处理</li>\n</ul>\n</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源端口号：68，目的端口号：67</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源IP地址：0.0.0.0，目的IP地址：255.255.255.255</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源MAC地址：他自己，目的IP地址：fffffff</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>DHCP服务器发送DHCP offer报文，携带即将分配给客户机的IP地址和相关信息</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源端口号：67，目的端口号：68</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源IP地址：他自己IP地址，目的IP地址：分配的IP地址（华为），255.255.255.255（其他厂家）</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源MAC地址：他自己，目的IP地址：客户机MAC地址（华为）,fffffff（其他厂家）</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>客户机接受此分配，广播DHCP request报文，向服务器请求使用该IP地址<ul>\n<li>一方面需要告诉获取IP地址的服务器，请求该IP地址；</li>\n<li>另一方面，需要告诉剩余没有获取IP地址的服务器，可以释放该IP地址</li>\n</ul>\n</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源端口号：68，目的端口号：67</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源IP地址0.0.0.0，目的IP地址：255.255.255.255</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源MAC地址：他自己，目的IP地址：fffffff</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>DHCP服务器收到后，发送DHCP ack报文，告知客户机允许使用该IP地址</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源端口号：67，目的端口号：68</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源IP地址：他自己IP地址，目的IP地址：分配的IP地址（华为），255.255.255.255（其他厂家）</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">源MAC地址：他自己，目的IP地址：客户机MAC地址（华为）,fffffff（其他厂家）</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>客户机使用无故ARP来检测是否有人使用此IP地址，若没有人响应就使用。</li>\n</ol>\n</li>\n<li><p>DHCP租期：</p>\n<ul>\n<li>租期更新计时器：<ul>\n<li>华为默认24小时：</li>\n<li>租期到达一半（12小时）<ol>\n<li>PC发送一个DHCP request报文，是<strong>单播</strong>发送</li>\n<li>若服务器回复ACK报文，则租期更新计时器刷新</li>\n<li>若服务器回复MAK报文，PC等待下一个更新周期</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>租期重绑计时器：<ul>\n<li>当租期到达87.5%（21小时），此时PC进行第二次续租</li>\n<li>PC发送DHCP Request，使用<strong>广播</strong><ul>\n<li>如果收到ACK报文，则刷新各类计时器，并绑定新的服务器</li>\n<li>如果收到NAK报文，则PC必须立刻停止使用现在使用的IP地址，然后重新申请IP地址</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>租期失效计时器：<ul>\n<li>PC在租期内正常到期，服务器没有回复，PC才停止使用该IP地址，并发送DHCP release报文<ul>\n<li>PC重新进入DHCP工作流程，发送DHCP discover报文申请IP地址</li>\n</ul>\n</li>\n<li>PC主动放弃使用分配得的IP地址，此时发送DHCP release报文</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>地址池：</p>\n<ul>\n<li>全局地址池：为所有连接到服务器的PC提供地址</li>\n<li>接口地址池：为连接到该接口</li>\n</ul>\n</li>\n<li><p>先给路由器端口和服务器配置IP地址子网掩码</p>\n</li>\n<li><h3 id=\"全局地址池配置：\"><a href=\"#全局地址池配置：\" class=\"headerlink\" title=\"全局地址池配置：\"></a>全局地址池配置：</h3><ul>\n<li><p>开启DHCP服务（在配置模式下）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dhcp enable</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建名为…的全局地址池：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip pool [name]  # 一台设备上可以创建多个池塘，但一个池塘只能服务一个广播域</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置IP地址池的子网地址和子网掩码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">network [IP网段] mask [子网掩码/网络地址长度] </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置默认网关：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gateway-list [IP地址]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>配置DNS服务器IP地址：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dns-list [IP地址1] [IP地址2]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置地址租约时间（可选，默认24小时）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lease day [num] hour [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>排除IP地址：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">excluded-ip-address 192.168.1.253 192.168.1.253   # 将192.168.1.253排除在地址段外</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>进入相对应的端口，启动dhcp服务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dhcp select global</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在终端上设置IPv4设置为DHCP</p>\n</li>\n</ul>\n</li>\n<li><h3 id=\"接口地址池配置：（了解）\"><a href=\"#接口地址池配置：（了解）\" class=\"headerlink\" title=\"接口地址池配置：（了解）\"></a>接口地址池配置：（了解）</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Huawei]dhcp enable</span><br><span class=\"line\">[Huawei-GigabitEthernet0/0/0]dhcp select interface //开启接口DHCP功能</span><br><span class=\"line\">[Huawei-GigabitEthernet0/0/0]dhcp server dns-list 114.114.114.114</span><br><span class=\"line\">[Huawei-GigabitEthernet0/0/0]dhcp server excluded-ip-address 192.168.1.10 192.168.1.253</span><br><span class=\"line\">[Huawei-GigabitEthernet0/0/0]dhcp server static-bind ip-address 192.168.1.5 mac-address 5489-9842-3FA4</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"4-VLAN虚拟局域网\"><a href=\"#4-VLAN虚拟局域网\" class=\"headerlink\" title=\"4.VLAN虚拟局域网\"></a>4.VLAN虚拟局域网</h2><ul>\n<li><p>网络速率 约等 带宽&#x2F;8)*85%</p>\n</li>\n<li><p>交换机和路由器协同工作后，将原来的一个广播域逻辑的切分为多个</p>\n</li>\n<li><p>交换机创建VLAN（在配置模式下）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vlan [num]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">用户范围1~4094，VLAN1已存在，默认所有的接口都存在VLAN1中</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">批量创建</span></span><br><span class=\"line\">vlan batch [num1] to [num2]   </span><br><span class=\"line\">vlan batch [num1] to [num2] [num3] to [num4]  </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>交换机查看VLAN</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display vlan</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给交换机接口划分VLAN（进入该接口）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type access        # 先将该接口修改为接入模式</span><br><span class=\"line\">port default vlan [num]      # 将该接口划分到对应的VLAN中</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">批量的将多个接口划分到VLAN中</span></span><br><span class=\"line\">port-group group-member Ethernet [接口号] to Ethernet [接口号]</span><br><span class=\"line\">port link-type access</span><br><span class=\"line\">port default vlan [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给交换机接口设置trunk模式，并设置允许通过VLAN（先进入接口模式下）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type trunk    # 将接口修改为trunk模式</span><br><span class=\"line\">port trunk allow-pass vlan [[num1] to [num2] / all]   # 默认华为交换机仅允许VLAN1通过，需要定义允许列表</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>给路由器创建子接口，定义其管理的VLAN，配置IP地址，开启ARP功能</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface g[子端口]                         # 如：0/0/0.1，创建子接口</span><br><span class=\"line\">dot1q termination vid [num]                # 定义其管理的VLAN</span><br><span class=\"line\">ip address [IP地址] [子网掩码/网络地址长度]</span><br><span class=\"line\">arp broadcast enable                         # 开启ARP功能</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"5-路由：\"><a href=\"#5-路由：\" class=\"headerlink\" title=\"5.路由：\"></a>5.路由：</h2><h3 id=\"1-静态路由：\"><a href=\"#1-静态路由：\" class=\"headerlink\" title=\"1.静态路由：\"></a>1.静态路由：</h3><ul>\n<li><p>查看路由表详情：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">目的地址/掩码         协议      优先级  开销值           下一条           接口</span><br><span class=\"line\">Destination/Mask    Proto     Pre    Cost      Flags  NextHop         Interface</span><br><span class=\"line\">127.0.0.0/8         Direct    0      0         D      127.0.0.1       InLoopBack0</span><br><span class=\"line\">127.0.0.1/32        Direct    0      0         D      127.0.0.1       InLoopBack0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>若匹配上多条路由项，则按照 “<strong>最长掩码匹配规则</strong>“ 进行选择</p>\n</li>\n<li><p>路由的来源：</p>\n<ul>\n<li>直连路由：设备自动发现</li>\n<li>静态路由：手工配置</li>\n<li>动态路由：通过动态协议算法计算得出</li>\n</ul>\n</li>\n<li><p>路由优先级：</p>\n<table>\n<thead>\n<tr>\n<th>路由来源</th>\n<th>缺省优先级（华为）</th>\n<th>缺省优先级（思科）</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>直连路由</td>\n<td>0</td>\n<td>0</td>\n</tr>\n<tr>\n<td>OSPF</td>\n<td>10</td>\n<td>110</td>\n</tr>\n<tr>\n<td>静态路由</td>\n<td>60</td>\n<td>100</td>\n</tr>\n<tr>\n<td>RIP</td>\n<td>100</td>\n<td>120</td>\n</tr>\n<tr>\n<td>BGP</td>\n<td>255</td>\n<td>255</td>\n</tr>\n<tr>\n<td>EIGRP</td>\n<td></td>\n<td>90</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>如果时跳转到下一个路由器的下一个路由器的相连网段，下一跳路由器端口的IP地址写（下一个路由器）</p>\n</li>\n<li><p>可以对多个网段进行聚合，减少路由表的条数</p>\n</li>\n<li><p><strong>配置了源路由到目标路由的静态路由，还需配置目标路由到源路由的静态路由</strong></p>\n</li>\n<li><p>配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static [目标IP网段] [子网掩码/网络地址长度] [下一跳路由器端口的IP地址]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static 172.16.1.0 24 GigabitEthernet 0/0/1 192.168.1.2   # 接口配置静态路由（了解）</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"2-路由扩展配置：\"><a href=\"#2-路由扩展配置：\" class=\"headerlink\" title=\"2.路由扩展配置：\"></a>2.路由扩展配置：</h3><ol>\n<li><p>负载均衡（等价鲈鱼）：当访问相同目标，<strong>具有多条开销相等路径时</strong>，可以让设备将流量拆分后延多条路径同时传输，起到带宽叠加的作用，减少单条链路数据传输压力</p>\n</li>\n<li><p>环同接口：创建后，可用于路由器测试TCP&#x2F;IP协议组件是否能封装与解封；同时可用于实验环境中，<strong>模拟连接PC终端的用户接口</strong>，来减少实际设备成本需求。</p>\n<ul>\n<li><p>创建LoopBack虚拟接口（配置模式下）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface LoopBack [0~2147483647]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置虚拟接口IP地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip address 1.1.1.1 24</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建环回接口可以在本设备上ping通本设备上的所有端口，相当于本设备连接了一个虚拟终端PC</p>\n</li>\n</ul>\n</li>\n<li><p>手工汇总：当路由器需要配置多条路由项时，可以选择将其进行<strong>子网汇总</strong>，减少路由表项数量，降低CPU运算负载，提高转发效率</p>\n</li>\n<li><p>路由黑洞：在手工汇总时，可能会包含一些网络中实际<strong>不存在的网段</strong>，造成流量有去无回的现象，浪费了链路资源</p>\n</li>\n<li><p>缺省路由：一条不限定目标的路由，代表所有的网段；路由器查表时在查询完本地所有的直连，静态，动态路由后若依然没有可达路径，才使用该条目。</p>\n<ul>\n<li><p>设置缺省路由：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static 0.0.0.0 0.0.0.0 &lt;下一跳路由器的IP地址&gt;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>空接口：当路由黑洞与缺省路由相遇时，将必然出现环路；在黑洞路由器上（<strong>汇总路由的下一跳路由器</strong>），<strong>配置一条到达汇总网段的空接口路由</strong>，空接口及丢弃流量，来<strong>避免环路</strong>的产生。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static [汇总后的IP地址] [子网掩码/网络地址长度] NULL 0   # 除路由黑洞和缺省相遇的情况外，汇总的网段的路由器上都得写</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>浮动静态：访问相同目标，具有多条路径时，将加载优先级最小的路径到表中；若优先级相同将同时加入表中（负载均衡）；因此修改部分路由的<strong>优先级</strong>，可以实现静态备份的效果。</p>\n<ul>\n<li><p>设置静态路由优先级：（越小优先级越大）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip route-static [目标IP地址] [子网掩码/网络地址长度] preference [num]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>环路：当两个路由器上的路由表，分别存在一条到达同一网段且下一条是另一台路由器时，将形成环路</p>\n<ul>\n<li>占用大量带宽，影响正常数据包转发</li>\n<li>损耗路由器资源，当路由器资源消耗过大时，设备会宕机</li>\n<li>解决方式—TTL</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"3-动态路由\"><a href=\"#3-动态路由\" class=\"headerlink\" title=\"3.动态路由\"></a>3.动态路由</h3><ul>\n<li><p>静态协议的优缺点及结论：</p>\n<ul>\n<li><p>缺点：</p>\n<ol>\n<li>中大型网络配置量过大</li>\n<li>不能基于拓扑的变化而实时变化</li>\n</ol>\n</li>\n<li><p>优点：</p>\n<ol>\n<li>不会额外占用物理资源</li>\n<li>安全问题</li>\n<li>计算路径问题</li>\n</ol>\n</li>\n<li><p>结论：小型网络建议使用静态路由；中大型较复杂网络，建议使用动态</p>\n</li>\n</ul>\n</li>\n<li><p>动态路由协议：</p>\n<ul>\n<li><p>概念：路由器间沟通，协商，计算自动生成路由表；在拓扑结构发生变化后，可以实时收敛（重新计算）来适应新的结构</p>\n</li>\n<li><h4 id=\"基于AS进行分类：（AS自治系统-0-65535标准编号）\"><a href=\"#基于AS进行分类：（AS自治系统-0-65535标准编号）\" class=\"headerlink\" title=\"基于AS进行分类：（AS自治系统 0~65535标准编号）\"></a>基于AS进行分类：（AS自治系统 0~65535标准编号）</h4><ul>\n<li>IGP 内部网关路由协议，AS内部使用（RIP，OSPF，EIGRP，ISIS…..）</li>\n<li>BGP 外部网关路由协议，AS之间使用（BGP，EGP）</li>\n</ul>\n</li>\n<li><h4 id=\"IGP分类：\"><a href=\"#IGP分类：\" class=\"headerlink\" title=\"IGP分类：\"></a>IGP分类：</h4><ul>\n<li>基于工作特点进行分类：<ul>\n<li>DV 距离矢量（RIP，EIGRP）：向相邻路由器共享路由表</li>\n<li>LS 链路状态（OSPF，ISIS）：向邻接路由器共享拓扑图，自我计算路由；<ul>\n<li>优点：防环能力上优于距离矢量，选路能力上也优于距离矢量；</li>\n<li>缺点：更新量大，占带宽</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>基于更新时是否携带子网掩码：<ul>\n<li>有类别（不携带子网掩码，按主类定义子网掩码）</li>\n<li>无类别（携带子网掩码，基于实际掩码来判断网段）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"1-RIP协议：\"><a href=\"#1-RIP协议：\" class=\"headerlink\" title=\"1.RIP协议：\"></a>1.RIP协议：</h4><ul>\n<li><p>RIP：路由信息协议，也称距离矢量协议</p>\n</li>\n<li><p>存在三个版本：V1  &#x2F;  V2 &#x2F; NG（下一代IPV6专用）</p>\n</li>\n<li><p>特点：</p>\n<ul>\n<li><p>基于<strong>UDP520端口</strong>工作；<strong>使用跳数作为度量（最大跳数为15，当值为16时，该路由不可达）</strong>；</p>\n</li>\n<li><p>更新方式：<strong>30s周期更新</strong>（保活，确认），<strong>触发更新</strong>（开销值发生变化时）；</p>\n</li>\n<li><p>支持等开销负载均衡</p>\n</li>\n</ul>\n</li>\n<li><p>V1和V2的区别：</p>\n<ul>\n<li>更新是是否携带掩码：<ul>\n<li>V1有类别协议（不携带子网掩码），不能区分和汇总</li>\n<li>V2无类别协议（携带子网掩码），进行子网划分（VLSM）和子网汇总（不能比主类短），不支持<strong>超网</strong>（可以比主类短）</li>\n</ul>\n</li>\n<li>更新方式：<ul>\n<li>V1是广播更新（255.255.255.255）</li>\n<li>V2组播更新（224.0.0.9）</li>\n</ul>\n</li>\n<li>V2支持手工认证</li>\n</ul>\n</li>\n<li><h3 id=\"RIP环路问题：\"><a href=\"#RIP环路问题：\" class=\"headerlink\" title=\"RIP环路问题：\"></a>RIP环路问题：</h3><p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221026170448015.png\" alt=\"image-20221026170448015\"></p>\n<ul>\n<li><p>触发更新：</p>\n<ul>\n<li>当某一个路由器中的<strong>路由项发生改变</strong>时，不需要等待下一次周期更新到来，就可以直接将发生改变的路由项发送</li>\n<li>不能完全避免环路发生</li>\n</ul>\n</li>\n<li><p>水平分割（华为默认开启）：从此口进（从此口学到的路由），不从此口出（下一次不从此口发出去）</p>\n</li>\n<li><p>毒性逆转：当这条路由不可达时，向对方发送这条路由，但度量为16；然后打破水平分割，将此路由发回来进行确认，然后扩散这条路由</p>\n</li>\n<li><p>跳数限制：15跳为最大条数</p>\n</li>\n<li><p>抑制计时器</p>\n</li>\n<li><p>注意：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">水平分割和毒性逆转机制，原理相同，但是做法不同，故只能选择其中一个与触发更新搭配防环。</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">若水平分割和毒性逆转机制同时开启，则按照毒性逆转执行。</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>例题：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">问题：能不能光使用水平分割或毒性逆转机制，不使用触发更新？</span><br><span class=\"line\">答：理论上可以，但实际不行；触发更新可以加快路由的收敛速度。</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>RIP的数据包：</p>\n<ul>\n<li>request包（请求报文）：只能在启动RIP进程后使用，希望尽快获取邻居的路由信息</li>\n<li>response包（应答报文）：携带了具体的路由信息，用来回答请求报文（周期发送）</li>\n</ul>\n</li>\n<li><p>RIP工作原理：</p>\n<ol>\n<li><p>初始化：</p>\n<ul>\n<li>RIP在初始化时，会从每一个参与工作的接口上发送请求数据包。该请求数据包会向所有的RIP路由器请求一份完整的路由表</li>\n<li>该请求通过广播形式（组播形式）发送</li>\n</ul>\n</li>\n<li><p>接受请求：</p>\n<ul>\n<li>RIP路由器在接收到请求数据包后，会使用应答数据包回复，且<strong>该数据包包含了本地所有的路由信息</strong></li>\n</ul>\n</li>\n<li><p>接受到响应数据包：</p>\n<ul>\n<li>路由器接收并处理该数据包</li>\n<li><strong>将接受到的数据包内容与自己本地路由表</strong>进行对比，然后进行添加，删除，修改等操作</li>\n</ul>\n</li>\n<li><p>常规路由更新：</p>\n<ul>\n<li><p>当收敛完成后，路由器会以30S为周期，发送应答包文</p>\n</li>\n<li><p>邻居路由器收到应答报文后，会设置180s的超时时间，如果180s内没有收到邻居发来的应答报文，路由器会认为邻居出现问题，并将下一跳设置为16</p>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n<li><p>RIP算法：贝尔曼福特算法</p>\n<ol>\n<li>当接收到的数据包中含有本地路由表中没有的路由项，则直接加载到本地路由表</li>\n<li>当接收到的数据包含有本地已具有的路由项时，且下一跳地址相同，则将数据包中的路由项更新至本地</li>\n<li>当接收到的数据包中含有本地已具备的路由项时，但下一跳不同，则比较COST值，若本地路由表中的COST值较大，则进行更；若本地路由表中的COST值较小，则不进行更新</li>\n</ol>\n</li>\n<li><p>RIP计时器：</p>\n<ul>\n<li><p>更新计时器：</p>\n<ul>\n<li>每台启动了RIP协议的路由器，都有一个属于自己的更新计时器</li>\n<li>30S</li>\n<li>当更新<strong>计时器为0</strong>时，则向周围<strong>发送响应报文</strong></li>\n<li>为什么要进行周期更新？<ul>\n<li>UDP是不可靠的</li>\n<li>RIP路由传递过程中需要可靠机制</li>\n<li>RIP</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>无效计时器：</p>\n<ul>\n<li>每台路由器上的每一个路由项都有一个无效计时器</li>\n<li>180S(一般是更新计时器的六倍)</li>\n<li>每条路由条目被更新时，计时器刷新为180S</li>\n<li>当<strong>计时器为0</strong>时，则认为该<strong>路由项无效</strong>，会将<strong>开销值设置为16</strong>，并向外传输（告诉其他路由器，这个网段不可达）</li>\n</ul>\n</li>\n<li><p>垃圾收集计时器：</p>\n<ul>\n<li><strong>当一个路由项变为无效路由项时</strong>，虽然COST值会被设置为16，但是路由项本身并不会被立刻删除，而是会<strong>启动垃圾收集计时器</strong>，在这个计时器倒计时为0前，该路由器周期更新时仍然会携带该无效路由项</li>\n<li>一旦该<strong>计时器为0</strong>，则<strong>删除该路由项</strong>（包括之前与之对应的无效计时器，垃圾收集计时器）</li>\n<li>120S（更新计时器的四倍）</li>\n<li>注意：垃圾收集计时器为0前的某一时刻，该路由项被更新，则该路由项可以正常加表使用，COST值回复，删除垃圾收集计时器，回复无效计时器</li>\n</ul>\n</li>\n<li><p>例题：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">假设某一时刻，一台路由器的RIP路由器中共有30个路由项，其中COST值的有23个，等于16的有7个，问，此时一共有多少个计时器在工作？分别是什么计时器？</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>具体配置步骤：</p>\n<ol>\n<li>启动RIP：（配置模式下，启动时可以定义进程号，默认1，范围1~65535）</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rip [进程IP]</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>选择版本：（版本1：其他路由获取得到的IP地址是主类，版本2：其他路由获取得到的IP地址是精确的网络地址）</li>\n</ol>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version [num]</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>宣告（含义：激活（被选中接口可以收发RIP的信息）和共享路由（被选中接口的网段可以共享给本地的所有邻居））：</li>\n</ol>\n  <figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">network [端口网络地址]</span><br><span class=\"line\">如：network 12.0.0.0   network 172.16.0.0   network 192.168.1.0 </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">如果有多个不同的主类端口，宣告多次；如果多个接口主类相同，只宣告一次</span> </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>RIP的扩展配置：</p>\n<ul>\n<li><p>RIPversion2的手工汇总：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rip summary-address [汇总网段] [子网掩码]    # 在发送RIP数据包接口上汇总</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在对方的路由器上查看路由表，验证是否汇总</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>RIPversion2的认证：（所有RIP的信息将被加密传输，两两直连的邻居间，认证口令和模式必须完全一致）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">接口配置</span></span><br><span class=\"line\">rip authentication-mode [加密算法] usual cipher [具体密码] </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>沉默接口（只收不发路由协议信息，只能用于连接用户终端的接口）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">这些接口在沉默后即使被宣告，依然不会被</span></span><br><span class=\"line\">slient-interface ???Ethernet[端口号]  # 先进入rip</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>加快收敛：适当的修改计时器，可以加快协议的收敛速度；修改时，全网所有运行RIP的设备建议一致；维持原有倍数关系，且不易修改的过小。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">更新30S，实效180s,刷新300s（cisco240s）</span></span><br><span class=\"line\">timers rip [更新时间] [失效时间] [刷新时间]   # 单位s，先进入rip</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>缺省路由：在<strong>边界路由器上</strong>定义缺省源头信息后，将向内网发布缺省路由，之后内部路由器将自动生成缺省路由指向边界路由器方向，边界路由器指向ISP的缺省路由，依然需要手写</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">default-route originate   # 先进入rip</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>域外某网段修改开销值：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rip metricin ip-prefix p24 3    # 先进入某接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"2-OSPF协议：\"><a href=\"#2-OSPF协议：\" class=\"headerlink\" title=\"2.OSPF协议：\"></a>2.OSPF协议：</h4><ul>\n<li><p>OSPF：开放式最短路径优先协议，<strong>无类别（带掩码）链路状态igp协议</strong>，周期更新（30min）+触发更新</p>\n</li>\n<li><p>跨四层封装（传输层），基于IP封装，协议号89</p>\n</li>\n<li><p>版本：v1（实验室阶段夭折），v2（IPv4），v3（IPv6）</p>\n</li>\n<li><p>链路状态协议的更新量随着网络范围的扩展指数性的上升，因此OSFP协议为了在中大型网络中工作，<strong>需要结构化的部署</strong>（<strong>区域之内传递拓扑，区域传递路由</strong>）</p>\n</li>\n<li><p>为什么需要结构化部署：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">因为OSPF是无类别链路状态IGP协议，而链路状态最大的特点就是共享拓扑，而共享拓扑；而共享拓扑的话就会产生大量的更新这样不利于网络的流通，因此需要合理的流畅，因此需要合理的IP规划，进行结构化部署。区域之内是LSA的拓扑数据交换：区域之内传递拓扑，区域传递路由</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>区域划分的目的或链路状态协议的距离矢量特征：区域之内传递拓扑，区域传递路由</p>\n</li>\n<li><p>更新方式：组播更新（224.0.0.5（all），224.0.0.6（DR&#x2F;BDR））</p>\n</li>\n<li><p>算法：SPF（最短路径优先算法）</p>\n</li>\n<li><p>OSPF的五种数据包：</p>\n<ol>\n<li>Hello：1.邻居的发现，关系的建立；2.周期（以太网10s）的保活；3.携带rid（IP地址格式）</li>\n<li>Dbd：数据库描述报文（本地数据库目录（发送链路状态中自身知道的）），LSDB：链路状态数据库，存储LSA信息的数据库</li>\n<li>Lsr：链路状态请求报文（请求对方我不知道的）</li>\n<li>Lsu：链路状态更新报文（返回我不知道的拓扑或者路由）</li>\n<li>Lsack：链路状态确认报文（保证可靠性）</li>\n</ol>\n</li>\n<li><p>OSPF的7个状态机：（两个路由器的关系）</p>\n<ol>\n<li><p><strong>Down</strong>：双方都不认识对方（A与B）</p>\n</li>\n<li><p><strong>init初始化</strong>：，B接收到hello包中（不包含自己的名字），B知道了A，B进入init状态</p>\n</li>\n<li><p><strong>2way双向通讯</strong>：B接收到hello包中（包含自己的名字），<strong>邻居关系建立</strong>的标志</p>\n<ul>\n<li>条件匹配成功进入下一个状态，如果条件匹配失败，则停留在邻居关系，仅使用hello进行周期保活</li>\n</ul>\n</li>\n<li><p><strong>Exstart预启动</strong>：使用不携带目录信息的DBD包，1.进行主从关系的选举；<strong>rid大为主</strong>，为主的可以优先获取LSA信息，解决了目录共享时的无序，避免了它们的同时更新；2.主方可以住到隐形确认，可以定义隐形确认中的序列号。</p>\n</li>\n<li><p><strong>Exchange准交换</strong>：使用携带目标信息的dbd包（谁的rid大先发送dbd包），共享本地数据库目录</p>\n</li>\n<li><p><strong>loading加载</strong>：查看完邻接的dbd信息后，对比本地，然后基于本地未知的Lsa进行查询；使用lsr向对端查询，对端使<strong>用lsu来传输这些lsa信息</strong>，本地<strong>收到后需要lsack来进去确认</strong></p>\n</li>\n<li><p><strong>Full</strong>：<strong>邻接关系建立</strong>标志；意味着邻接间，数据库同步（一致）；邻接关系的设定是为了和之前邻居关系进行区分，邻居关系只是单纯的使用hello包进行保活，而只有邻接关系，才会发LSA信息</p>\n</li>\n</ol>\n</li>\n<li><p>名词解释：</p>\n<ul>\n<li>邻居关系：邻居关系就是只交互过hello报文，并不知道邻居具体的Lsa</li>\n<li>邻接关系：就是两个邻居之间完成交互过各种报文，两台路由器拥有各自的明细拓扑信息Lsdb完全同步</li>\n<li>Lsdb：链路状态数据库，所有lsa的集合</li>\n<li>Lsa【货物】：链路状态通告，具体的一条一条拓扑或路由信息，基于LSU包进行共享（LSU运输）</li>\n</ul>\n</li>\n<li><p>结构突变：</p>\n<ul>\n<li>新增网段：触发更新– LSU和LSack 直接告知</li>\n<li>断开网段：触发更新– LSU和LSack 直接告知</li>\n<li>无法沟通：dead time为hello包的4倍；在4次周期内未收到对端的hello包，将断开与其邻居关系，删除通过该邻居计算所得路由</li>\n</ul>\n</li>\n<li><h3 id=\"OSPF的工作过程：\"><a href=\"#OSPF的工作过程：\" class=\"headerlink\" title=\"OSPF的工作过程：\"></a>OSPF的工作过程：</h3><ol>\n<li>启动配置完成后，OSPF向本地所有运行协议的接口以组播224.0.0.5的形式发送hello包，（包含本地的RID以及自己已知的邻居的RID）；之后，将收集到的邻居关系记录在一张表 — <strong>邻居表</strong></li>\n<li>之后需要关注条件，若不能建立为邻接，将保持为邻接关系，仅hello包周期保活</li>\n<li>若条件匹配可以建立邻接关系，先使用未携带数据库目录信息的DBD包来进行主从关系的选举，之后由主引导先后顺序使用携带目录信息的DBD包共享数据库目录</li>\n<li>之后本地基于其他设备的目录，判断由本地未知的LSA信息，再使用LSR&#x2F;LSU&#x2F;LSACK来通过邻接获取具体的LSA信息，完成本地的<strong>数据库表</strong>（LSDB链路状态数据库）</li>\n<li>本地数据库完整后，本地将基于数据库中的内容启动SPF算法，将数据库整理为有向图–&gt;最短路径树—-&gt;将本地到达所有未知网段的最短路径加载于本地的<strong>路由表</strong>中</li>\n<li>路由表建立完成，收敛结束，之后每<strong>10S</strong>使用<strong>hello</strong>包周期保活；每<strong>30min</strong>邻接间进行一次<strong>数据库目录核对</strong></li>\n</ol>\n</li>\n<li><h4 id=\"区域划分规则：\"><a href=\"#区域划分规则：\" class=\"headerlink\" title=\"区域划分规则：\"></a>区域划分规则：</h4><ol>\n<li><p>星型结构：编号0骨干区域（中心），大于0为非骨干区域（分支），非骨干区域必须直连骨干区域</p>\n</li>\n<li><p>必须存在ABR：区域边界路由器，骨干区域0与非骨干区域相连&gt;0的设备；区域之间可以存在多个ABR设备；一个ABR也可以连接多个区域</p>\n</li>\n</ol>\n</li>\n<li><p>区域ID：用来区分和标识OSPF的不同区域，32位二进制构成；也可以使用点分十进制表示，还可以直接使用十进制表示；其中，骨干区域的ID、必须设置为0。</p>\n</li>\n<li><h3 id=\"RID（路由器id）：\"><a href=\"#RID（路由器id）：\" class=\"headerlink\" title=\"RID（路由器id）：\"></a>RID（路由器id）：</h3><ul>\n<li><p>格式IPv4地址，可以区分和标定不同的路由器</p>\n</li>\n<li><p>32位二进制构成，全网唯一，格式统一（采用点分十进制的方式表示）</p>\n</li>\n<li><p>RID的获取方式：</p>\n<ol>\n<li><p>手工配置：</p>\n</li>\n<li><p>自动生成：1.优先选择环回接口中IP地址最大的作为RID，2.如果没有环回，则选择物理接口中IP地址最大的作为RID</p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li><p>基础配置：</p>\n<ol>\n<li><p>启动时定义进程号（配置模式，默认进程1）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num] router-id [路由器id]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>宣告接口地址（激活（可以收发OSPF的信息），被选中接口的拓扑信息可以共享给邻接，区域划分）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">area 0   # 先定义区域</span><br><span class=\"line\">network [接口IP地址] [反子网掩码]   </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查询ospf：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf peer   # 查看邻居关系表</span><br><span class=\"line\">display ospf peer brief   # 查看邻居简表</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ospf lsdb    # 查看LSDB</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">邻居关系建立后，关注件匹配失败，保持为邻居关系，仅hello包周期保活；匹配成功过，可以建立邻接关系；邻接关系间，将使用  DBD/LSR/LSU/LSack来获取本地未知的LSA信息，完整本地的LSDB（数据库表）</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip routing-table protocol ospf   # 查看ospf路由</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">优先级为10;度量为cost值；cost值=开销值</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当数据库同步完成后，本地基于SPF（最短路径有心啊）算法，将数据录转换为有向图，再将有向图转换为树形结构；之后基于树形结构，以本地为起点到达所有未知网段的最短路劲，加载到路由表中。</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bandwidth-reference 1000    # 若修改带宽，全网需要一致（单位MB/s），先进入ospf</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">OSPF cost=参考带宽/接口带宽，-----默认参考带宽为100M</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">OSPF优先cost值之和最小，为最佳路径；</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">若两条链路cost值之和相同，等开销负载均衡；若接口带宽大于参考带宽，cost为1，将可能导致选路不佳，建议修改默认的参考带宽</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><p>扩展配置：</p>\n<ol>\n<li><p>DR（一个路由器）&#x2F;BDR（备份路由器）选举（有DR才有拓扑交换和lsa信息，才有路由）：</p>\n<ul>\n<li><p>邻居成为邻接关系的条件，与网络类型有关</p>\n</li>\n<li><p>网络类型：</p>\n<ul>\n<li>点到点：在一个网段内只能存在两个节点（串线链路）</li>\n<li>MA-多路访问：在一个网段内的节点数量不限制；不是当下连接了几个节点；而是该网络类型允许<strong>最终连接多个节点</strong>（以太网）</li>\n</ul>\n</li>\n<li><p>点到点网络邻居关系必成为邻接关系；</p>\n</li>\n<li><p>在MA网络中，将进行DR&#x2F;BDR选举；在一个<strong>网段</strong>中仅DR（大哥）&#x2F;BDR（二哥）与DRother其他路由器（小弟）为邻接关系，非DR&#x2F;BDR之间（小弟与小弟之间）为邻居关系</p>\n<ul>\n<li><p>选举规则：</p>\n<ol>\n<li>先比较<strong>一个网段</strong>所有参选接口的优先级，默认优先级为1，取值范围0-255，越大越优；0标识不参选</li>\n<li>若优先级相同，比较参选设备的RID，数值大优</li>\n</ol>\n</li>\n<li><p>干涉选举：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf dr-priority 1   # 先进入这个参选接口</span><br></pre></td></tr></table></figure>\n\n<p>注：由于网段DR&#x2F;BDR选举需要消耗40S，故为保障网络的稳定性，选举是<strong>非抢占的</strong>；一旦一个网段选举完成后，再修改优先级除非设备重启，否则无法干涉到结果；若需要干涉选举时，可以重启所有设备的OSPF</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reset opsf process   # 重启ospf进程</span><br></pre></td></tr></table></figure>\n\n<p><strong>最终的方法时修改非DR&#x2F;BDR设备的优先级为0，代表不参选；不用重启进程</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf dr-priority 0   # 先进入这个参选接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>区域汇总：OSPF协议不支持接口汇总，只能在将A区域拓扑计算所得路由共享给B区域时进行汇总</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]</span><br><span class=\"line\">area [num]    # 进入区域的边界路由器配置</span><br><span class=\"line\">abr-summary [汇总后的IP地址] [子网掩码]</span><br><span class=\"line\">display ip routing-table protocol ospf   # 在另一个区域的路由器查看是否汇总</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>被动接口：仅接收不发送路由协议信息，用于连接用户终端的接口，不得用于建立邻接关系</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">silent-interface g0/0/0</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>认证：在直连邻居或者邻接的接口上配置，保障更新的安全</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf authentication-mode [加密算法] [编号] cipher [具体密码]    # 模式，编号，密码要求邻居间一致</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>加快收敛：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf timer hello [num]   # 先进入接口</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>邻居间计时器 10s hello time，40s dead time</li>\n<li>ospf要求直连邻居间hello time和dead time必须完全一致，否则无法建立邻居关系</li>\n<li>修改本地的hello time，本地的dead time自动4倍关系匹配</li>\n</ul>\n</li>\n<li><p>缺省路由：<strong>边界路由器上配置</strong>后，将自动向内网下方一条缺省路由，之后<strong>内网设备将自动生成缺省路由边界</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ospf [num]</span><br><span class=\"line\">default-route-advertise always   </span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"3-RIP与OSPF的区别：\"><a href=\"#3-RIP与OSPF的区别：\" class=\"headerlink\" title=\"3.RIP与OSPF的区别：\"></a>3.RIP与OSPF的区别：</h4><ul>\n<li>相同点：<ol>\n<li>RIPv2和OSPFv2都是无类别（传递路由信息时是否携带子网掩码）的路由协议</li>\n<li>RIPv2（224.0.0.9）和OSPFv2（224.0.0.5，224.0.0.6）都使用组播来更新信息；所有224.0.0.X格式的组播地址我们称为本地链路组播，目的IP地址是本地链路组播的数据包中的TTL值被设定为1；所有本地链路组播都会存在对应的组播MAC地址，01-00-5e-后24位为组播IP地址的后24位</li>\n<li>RIPv2和OSPFv2都支持等开销负载均衡</li>\n</ol>\n</li>\n<li>不同点：<ol>\n<li>RIPv2只能适用于中小型网络环境中，而OSPFv可以适用于中大型网络环境</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"6-ACL访问控制列表：\"><a href=\"#6-ACL访问控制列表：\" class=\"headerlink\" title=\"6.ACL访问控制列表：\"></a>6.ACL访问控制列表：</h2><ul>\n<li><p>作用：</p>\n<ol>\n<li>访问控制（在路由流量进或除的接口上，匹配流量产生动作（允许，决绝））</li>\n<li>定义感兴趣流量（抓取流量，之后给其他的策略，让其他策略进行工作）</li>\n</ol>\n</li>\n<li><p>匹配规则：</p>\n<ul>\n<li><p>至上而下逐已匹配，上条匹配按上条执行，不再查看下条；</p>\n</li>\n<li><p>ciso系统默认末尾隐含拒绝所有；华为系末尾隐含允许所有</p>\n</li>\n</ul>\n</li>\n<li><p>分类：</p>\n<ol>\n<li>标准：仅关注数据包中的<strong>源IP地址</strong>；故调用时必修尽量的靠近目标，避免对其他流量的误删，<strong>编号范围2000-2999</strong>，一个编号为一个表</li>\n<li>扩展：关注数据包中的源，目标IP地址，<strong>目标端口号或协议号</strong>；<strong>编号范围3000-3999</strong>，由于扩展ACL<strong>源IP地址，目标IP地址</strong>均关注。故调用时尽量靠近源；</li>\n</ol>\n</li>\n<li><p>匹配命令：</p>\n<ul>\n<li><h3 id=\"标准：\"><a href=\"#标准：\" class=\"headerlink\" title=\"标准：\"></a>标准：</h3><ol>\n<li><p>选择路由器：因为只关注源IP地址，所以选择<strong>目标设备最近</strong>的路由器的最近接口（避免对流量进行误删）</p>\n</li>\n<li><p>定义acl列表名称</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acl [id]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>定义规则：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rule [permit/deny] source [IP地址] [通配符]</span><br><span class=\"line\">例：</span><br><span class=\"line\">rule deny source 192.168.1.3 0.0.0.0   #拒绝一个IP地址</span><br><span class=\"line\">rule deny source 192.168.2.0 0.0.0.255   #拒绝一个网段</span><br></pre></td></tr></table></figure>\n\n<p>通配符：0代表固定，1代表可变</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">抓去1.1.1.0/24 - 1.1.255.0/24网段中的奇数网段和偶数网段</span></span><br><span class=\"line\">奇数网段：rule deny source 1.1.1.0  0.0.254.0 </span><br><span class=\"line\">偶数网段：rule deny source 1.1.0.0  0.0.254.0 </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在接口上调用ACL（一个接口的一个方向只能调用一张表）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">traffic-filter [inbound/outbound] acl [列表ID]</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><h3 id=\"扩展：\"><a href=\"#扩展：\" class=\"headerlink\" title=\"扩展：\"></a>扩展：</h3><ul>\n<li><p>如果拒绝ping此路由器，此路由器所有接口需要设置</p>\n</li>\n<li><p>应该在<strong>与源设备最近的路由器</strong>配置（避免浪费资源）</p>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>仅关注源IP地址和目标IP地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rule [permit/deny] ip source [源IP地址] [通配符] destination [目标IP地址] [通配符]</span><br><span class=\"line\">例：</span><br><span class=\"line\">rule deny ip source 192.168.1.3 0.0.0.0 destination 192.168.3.2 0.0.0.0  </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>同时关注协议号，或目标端口号</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rule [permit/deny] [协议类型] source [源IP地址] [通配符] destination [目标IP地址] [通配符] destination-port eq [端口号]</span><br><span class=\"line\">例：</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">该条ACL拒绝了192.168.1.3对192.168.3.2的telnet远程登录</span></span><br><span class=\"line\">rule deny tcp source 192.168.1.3 0.0.0.0 destination 192.168.3.2 0.0.0.0 destination-port eq 23 </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拒绝192.168.1.10 对192.168.1.1 的icmp访问--ping</span></span><br><span class=\"line\">rule  deny icmp source  192.168.1.10 0.0.0.0 destination 192.168.1.1 0.0.0.0</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>Telnet：远程登陆，不加密，基于TCP，目标端口23</p>\n<ul>\n<li><p>条件；1.被登录设备与登录设备网络可达，2.被登录设备进行了telent服务配置</p>\n</li>\n<li><p>被登录设备配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">aaa     # 进入aaa模式</span><br><span class=\"line\">local-user [用户名] privilege level [权限值] password cipher [密码]</span><br><span class=\"line\">local-user [用户名] service-type telnet   # 该账号只用于什么登录</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user-interface vty 0 4     # 进入vty虚拟登录接口</span><br><span class=\"line\">authentication-mode aaa    # 在vty线上开启认证</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"7-NAT网络地址转换：\"><a href=\"#7-NAT网络地址转换：\" class=\"headerlink\" title=\"7.NAT网络地址转换：\"></a>7.NAT网络地址转换：</h2><ul>\n<li><p>概念：边界路由器对源IP地址或目标IP地址的修改</p>\n</li>\n<li><p>IPv4地址中，存在私有与公有IP地址的区别：</p>\n<ul>\n<li>公有：具有全球唯一性，可以在互联网通讯，需要付费使用</li>\n<li>私有：具有本地唯一性，不能在互联网通讯，无需付费使用</li>\n</ul>\n</li>\n<li><p>私有IP地址：A类：10.0.0.0&#x2F;8；B类：172.16.0.0&#x2F;16-172.31.0.0&#x2F;16；C类：192.168.0.0&#x2F;24-192.168.255.0&#x2F;24</p>\n</li>\n<li><p>分类：</p>\n<ul>\n<li>一对一（<strong>静态转换</strong>）：用于内部网络的服务器</li>\n<li>一对多（<strong>easy-ip</strong>）：内部的多个私有ip地址转换为同一个公有ip<ul>\n<li>简单的常用转换方式；属于动态性（PAT端口地址转换）</li>\n<li>多个私有地址共用同一个公有地址时，为了实现同时收发数据，在ip地址被转换成同一个公有地址的同时，还需要使用不同的源端口号来进行区分；</li>\n<li>由于端口号的数量限制，故在内部存在大量流量需要进入互联网时，若超过65535数量时，只能排队等候，导致网络延时，可以启用多对多；</li>\n</ul>\n</li>\n<li>多对多（<strong>动态转换</strong>）：内部的多个私有IP地址可以转换为多个公有IP地址<ul>\n<li>当内部存在大量的私有ip地址时，为保障网络的传输效率，需要多个公有ip地址循环提供端口来进行转换</li>\n</ul>\n</li>\n<li>端口映射：基于一个公有IP地址的特定端口进行转换<ul>\n<li>Network Address Port Translation（<strong>NAPT</strong>）：网络地址端口转换</li>\n<li>将边界路由器上的公有ip地址的某个特定端口与内部单个ip地址的特定端口进行映射</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><h3 id=\"一对多配置命令：\"><a href=\"#一对多配置命令：\" class=\"headerlink\" title=\"一对多配置命令：\"></a>一对多配置命令：</h3><ol>\n<li><p>先配置acl访问列表（让acl抓取流量，在边界路由器上）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">acl 2000</span><br><span class=\"line\">rule permit source [IP网段/IP地址] [通配符]      # 通配符中0表示固定</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>进入边界路由器接口，</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nat [inbound/outbound] [acl列表id]        # 公用IP地址为边界路由器接口IP地址</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><h3 id=\"一对一配置命令（先进入边界路由器接口）：\"><a href=\"#一对一配置命令（先进入边界路由器接口）：\" class=\"headerlink\" title=\"一对一配置命令（先进入边界路由器接口）：\"></a>一对一配置命令（先进入边界路由器接口）：</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在边界路由器上连接公网的外部接口上，固定的将内部192.168.1.10与外部12.1.1.3进行绑定</span></span><br><span class=\"line\">nat static global [要绑定公用IP地址] inside [内部绑定IP地址]</span><br></pre></td></tr></table></figure>\n</li>\n<li><h3 id=\"端口映射配置命令（先进入边界路由器接口）：\"><a href=\"#端口映射配置命令（先进入边界路由器接口）：\" class=\"headerlink\" title=\"端口映射配置命令（先进入边界路由器接口）：\"></a>端口映射配置命令（先进入边界路由器接口）：</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">公用IP地址为边界路由器接口IP地址，公网端口为边界路由器接口端口</span></span><br><span class=\"line\">nat server protocol tcp global current-interface [公网端口号] inside [内网IP地址] [端口号]  </span><br></pre></td></tr></table></figure>\n</li>\n<li><h3 id=\"多对多配置命令（先进入边界路由器接口）：\"><a href=\"#多对多配置命令（先进入边界路由器接口）：\" class=\"headerlink\" title=\"多对多配置命令（先进入边界路由器接口）：\"></a>多对多配置命令（先进入边界路由器接口）：</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nat address-group [分组号] [公用开始IP地址] [公用结束IP地址]   # 定义可用的公用IP地址段</span><br><span class=\"line\">acl 2000</span><br><span class=\"line\">rule permit source [IP网段/IP地址] [通配符]      # 通配符中0表示固定</span><br><span class=\"line\">nat outbound [列表ID] address-group [分组号]</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">扩展配置，no-pat若在多对多的命令末尾添加no-pat单词，那么将成为静态nat，最先出来的私有ip将一对一与这些公有ip形成静态的绑定关系，使得后出来的私有ip不能再被转换为公有；</span></span><br><span class=\"line\">nat outbound [列表ID] address-group [分组号] no-pat</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>​\t</p>\n","_path":"2023/03/19/1.网络基础/3.HCIA-华为模拟器和，路由，控制列表，ACL/","_link":"https://example.com/2023/03/19/1.%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/3.HCIA-%E5%8D%8E%E4%B8%BA%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%92%8C%EF%BC%8C%E8%B7%AF%E7%94%B1%EF%BC%8C%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8%EF%BC%8CACL/","_id":"clffcvmhq0007u4q44e74fnkl"}}