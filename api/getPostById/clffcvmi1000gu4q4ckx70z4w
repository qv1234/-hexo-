{"type":"getPostById","data":{"title":"交换技术和三层架构","date":"2023-03-19T11:48:57.125Z","description":"","categories":[{"name":"网络","_id":"clffcvmhk0004u4q4het76o2o"}],"tags":[{"name":"网络","_id":"clffcvmhn0005u4q4au3o5v4z"}],"content":"<h3 id=\"1-交换机\"><a href=\"#1-交换机\" class=\"headerlink\" title=\"1.交换机\"></a>1.交换机</h3><h4 id=\"1-概念：\"><a href=\"#1-概念：\" class=\"headerlink\" title=\"1.概念：\"></a>1.概念：</h4><ul>\n<li><p>二层基于MAC地址转发设备，依靠MAC地址表进行数据的转发</p>\n</li>\n<li><p>启动过程：</p>\n<ul>\n<li><p>RAM：随机存储（当前配置文件）</p>\n</li>\n<li><p>ROM：只读存储（自动程序）</p>\n</li>\n<li><p>NVRAM：非易失存储（保存配置）</p>\n</li>\n<li><p>Flash：闪存（操作系统）</p>\n</li>\n</ul>\n</li>\n<li><p>MAC地址表：1，VLAN ID，2.MAC地址，3.端口编号</p>\n</li>\n<li><p>地址表：老化时间5min洪泛：指的是将数据包复制进行转发，且转发的是除接收端口以外的所有端口（广播帧，组播帧，未知单播帧）</p>\n</li>\n<li><p><strong>广播域</strong>：一个数据包的洪泛范围</p>\n</li>\n<li><p>交换机的分类：</p>\n<ul>\n<li>二层交换机：只能解封装到二层</li>\n<li>多层交换机：只能解封装到某层，处理方式：1.进程转发，2.快速转发，3.FIB转发</li>\n</ul>\n</li>\n<li><p>二层交换机的工作方式：</p>\n<ul>\n<li>存储转发：</li>\n<li>贯穿转发：</li>\n<li>无分片转发：</li>\n</ul>\n</li>\n<li><p>交换机的基本功能：</p>\n<ul>\n<li>基于源MAC地址学习：针对源MAC地址与收到数据帧的接口和所属的VLAN加载到MAC地址表中</li>\n<li>基于目的MAC地址转发：针对目的MAC地址将数据从对应的接口转发出去</li>\n<li>数据过滤：收到数据出接口和入接口一致</li>\n<li>防止环路：</li>\n</ul>\n</li>\n<li><p>洪泛：指的是将数据包复制进行转发，且转发的是除接收端口以外的所有端口（广播帧，组播帧，未知单播帧）</p>\n</li>\n<li><p>被洪泛的数据帧：</p>\n<ul>\n<li>广播帧：IP地址255.255.255.255，MAC地址ff-ff-ff-ff-ff-ff</li>\n<li>组播帧：IP地址224-239.0.0.X，MAC地址01-00-5E-</li>\n<li>未知单播帧：MAC地址表中没有MAC地址的单播</li>\n</ul>\n</li>\n<li><p>交换机只为VLAN-ID相同的数据提供数据转发</p>\n</li>\n<li><p>查看MAC地址表：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display mac-table</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h4 id=\"2-VLAN虚拟局域网\"><a href=\"#2-VLAN虚拟局域网\" class=\"headerlink\" title=\"2.VLAN虚拟局域网\"></a>2.VLAN虚拟局域网</h4><ul>\n<li><p>VLAN 范围 ：1-4094</p>\n</li>\n<li><p>802.1Q封装：也称为dot1Q， 对流量进行VLAN 标记的。</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221209150445723.png\" alt=\"image-20221209150445723\"></p>\n</li>\n<li><p>PVID ： 端口VLAN 标识符 ，默认所有的接口PVID 为 VLAN 1 ;</p>\n</li>\n<li><p>接口类型： Access（连接终端），trunk（中继接口，传递标签），hybrid （混杂接口），802.1Qtunnel</p>\n<ul>\n<li>Access接口类型：<ul>\n<li>数据进入接口时，根据接口设置的vlan标签打入vlan标签</li>\n<li>数据出接口时，如果接口标签和数据帧中的标签一致，需要撕掉vlan标签；如果不一致无法通信</li>\n</ul>\n</li>\n<li>Trunk接口类型：<ul>\n<li>数据传出接口时，被发现帧中的vlan标签和tagged-list列表中的标签匹配，允许传出</li>\n<li>数据传入接口时，被发现帧中的vlan标签和tagged-list列表中的标签匹配，允许传入</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>链路类型：</p>\n<ul>\n<li>access：传递过程中不携带标签</li>\n<li>trunk：传递过程中携带标签</li>\n</ul>\n</li>\n<li><p>华为所有的接口存在两个列表： tagged-list（打标签列表 ） untagged-list（移除标签列表）</p>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>交换机创建VLAN（在配置模式下）：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vlan [num]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">用户范围1~4094，VLAN1已存在，默认所有的接口都存在VLAN1中</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">批量创建</span></span><br><span class=\"line\">vlan batch [num1] to [num2]   </span><br><span class=\"line\">vlan batch [num1] to [num2] [num3] to [num4]  </span><br><span class=\"line\">vlan batch [num1] [num2] .....</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>交换机查看VLAN</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display vlan</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>批量的设置接口类型为access，并指定接口的PVID</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port-group group-member [接口号] to [接口号]</span><br><span class=\"line\">port-group group-member [接口号1] [接口号2] .....</span><br><span class=\"line\">port link-type access       # 先将该接口修改为接入模式</span><br><span class=\"line\">port default vlan [num]     # 指定接口的PVID</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看MAC地址表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display mac-address</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改MAC地址条目老化时间：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mac-address aging-time [num]    # 单位秒</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看MAC地址表的老化时间：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display mac-address aging-time</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>静态MAC地址条目：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mac-address static [mac地址] [接口号] vlan [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>初始化接口所有配置： （初始化之后接口默认是关闭，需要手工开吭）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">clear configuration interface [接口号]</span><br><span class=\"line\">undo shutdown</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"3-Trunk中继协议：\"><a href=\"#3-Trunk中继协议：\" class=\"headerlink\" title=\"3.Trunk中继协议：\"></a>3.Trunk中继协议：</h4><ul>\n<li><p>使用一条物理链路传递多VLAN 的流量；</p>\n</li>\n<li><p>工作原理：</p>\n<ul>\n<li>交换机1的PC端访问交换机的PC端，数据到达交换机1先打上标签，再查看MAC地址表</li>\n</ul>\n</li>\n<li><p>给交换机接口设置trunk模式，并设置允许通过VLAN（先进入接口模式下）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type trunk    # 将接口修改为trunk模式</span><br><span class=\"line\">port trunk allow-pass vlan [[num1] to [num2] / all]   # 默认华为交换机仅允许VLAN1通过，需要定义允许列表</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如果设置允许所有VLAN通过，仅仅是允许本设备所创建的VLAN通过</p>\n</li>\n</ul>\n<h4 id=\"4-Hybrid混杂接口：\"><a href=\"#4-Hybrid混杂接口：\" class=\"headerlink\" title=\"4.Hybrid混杂接口：\"></a>4.Hybrid混杂接口：</h4><ul>\n<li><p><strong>华为交换机默认模式</strong> （access+trunk）</p>\n</li>\n<li><p>PVID ： 端口VLAN 标识符 ，默认所有的接口PVID 为 VLAN 1 ;</p>\n</li>\n<li><p>在链路中传递数据包可以有标签可以没有标签，同时可以自定义打标签列表和移除标签列表自定义打标签列表和移除标签列表\t</p>\n</li>\n<li><p>配置：（不同VLAN之间通信）</p>\n<ul>\n<li><p>先重置接口配置</p>\n</li>\n<li><p>hybrid连接主机的接口配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int [接口号]</span><br><span class=\"line\">port hybrid pvid vlan [num]       # 设置pvid值</span><br><span class=\"line\">port hybrid tagged vlan [num]   # 设置要打上的标签；只有设置打上指定标签，才能查看对应VLAN的MAC地址表</span><br><span class=\"line\">port hybrid untagged vlan [num]   # 设置要撕掉的标签</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>hybrid连接交换机的接口：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int [接口号]</span><br><span class=\"line\">port hybrid tagged vlan [num1] [num2] .....   # 设置要打上的标签</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看接口打标签列表和移除标签列表：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display port vlan active</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"5-MUX-VLAN-：\"><a href=\"#5-MUX-VLAN-：\" class=\"headerlink\" title=\"5.MUX VLAN ：\"></a>5.MUX VLAN ：</h4><ul>\n<li><p>相当于思科中私有VLAN （PVLAN ）</p>\n</li>\n<li><p>用于<strong>定义组VLAN和隔离VLAN</strong></p>\n</li>\n<li><p>从VLAN 分为：组VLAN 和 隔离VLAN </p>\n</li>\n<li><p>规则： </p>\n<ul>\n<li><p>主VLAN 可以和所有的从VLAN 通信，组VLAN 之内可以通信</p>\n</li>\n<li><p>从VLAN 之间不能通信，隔离VLAN 之内不能通信。</p>\n</li>\n</ul>\n</li>\n<li><p>配置MUX VLAN：</p>\n<ul>\n<li><p>创建所有的VLAN</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vlan batch [num1] [num2] ......</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在主VLAN当中开启MUX-VLAN 功能，同时关联自身所有的从VLAN （幵且制定从VLAN 的 类型）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vlan [主num]</span><br><span class=\"line\">mux-vlan       # 开启MUX-VLAN 功能</span><br><span class=\"line\">subordinate separate [num]    # 关联隔离从VLAN</span><br><span class=\"line\">subordinate group [num]       # 关联组从VLAN </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看主VLAN的表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display mux-vlan</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>将主接口划入VLAN：</p>\n<ul>\n<li><p>设置接口类型为access</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type access        # 先将该接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>指定接口的PVID值</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port default vlan [num]      # 先将该接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>开启MUX-VLAN 功能</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port mux-vlan enable   </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>将从接口以组的形式划分到VLAN中 ：</p>\n<ul>\n<li><p>划分接口进入组</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port-group group-member [接口号1] [接口号2] ......</span><br><span class=\"line\">port-group group-member [接口号1] to [接口号5]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置链路类型：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type access</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>划分VLAN</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port default vlan [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>开启MUX-VLAN 功能</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port mux-vlan enable    </span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><h3 id=\"在一个普通的VLAN中配置隔离VLAN：-只在一个普通的VLAN中使用\"><a href=\"#在一个普通的VLAN中配置隔离VLAN：-只在一个普通的VLAN中使用\" class=\"headerlink\" title=\"在一个普通的VLAN中配置隔离VLAN：(只在一个普通的VLAN中使用)\"></a>在一个普通的VLAN中配置隔离VLAN：(只在一个普通的VLAN中使用)</h3><ul>\n<li><p>全局模式开启端口隔离功能：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port-isolate mode l2</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>划分接口进入组</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port-group group-member [接口号1] [接口号2] ......</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>接口启用端口隔离幵指定相同的group ID （仅仅group ID 的接口相互隔离；相当于将所有的接口划入同一个隔离VLAN ）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port-isolate enable group [num1]     </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display port-isolate group [num1]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"6-Super-VLAN-：\"><a href=\"#6-Super-VLAN-：\" class=\"headerlink\" title=\"6.Super VLAN ：\"></a>6.Super VLAN ：</h4><ul>\n<li><p>超级VLAN ，聚合VLAN ,Super VLAN 之内的所有子VLAN 配置相同网段的IP地址（可以节约IP地址）</p>\n</li>\n<li><p>不同子VLAN 之间不能通信，不存在哪个接口存在super VLAN 中 ；</p>\n</li>\n<li><p>若子VLAN 之间要通信，必须在super VLAN 的三层接口开启ARP代理功能</p>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>先创建各从VLAN，并在接口修改链路类型和划分VLAN </p>\n</li>\n<li><p>开启ARP代理功能：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vlan [num]         # 创建聚合VLAN</span><br><span class=\"line\">aggregate-vlan     # 设置为聚合VLAN</span><br><span class=\"line\">access-vlan [num1] [num2]     # 关联子VLAN</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建SVI（vlan-if）接口：（需要配置两个接口）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int vlanif[num]    # num和VLAN-ID一致，相当于VLAN对应的子接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在SVI接口中配置IP地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip address [IP地址] [子网掩码/网络地址长度]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在SVI接口里，开启ARP代理功能</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arp-proxy inter-sub-vlan-proxy enable</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"7-VLAN-mapping：\"><a href=\"#7-VLAN-mapping：\" class=\"headerlink\" title=\"7.VLAN mapping：\"></a>7.VLAN mapping：</h4><ul>\n<li><p>VLAN 映射 ，在数据的传输过程中进行VLAN 标记的改变，一般被用于<strong>城域网</strong>中</p>\n</li>\n<li><p>用于私有VLAN通信，相当于NAT地址转换</p>\n</li>\n<li><p><strong>华为私有技术</strong></p>\n</li>\n<li><p>配置VLAN mapping的交换机，数据进入交换机时先映射再查表，数据转出交换机时先查表再映射</p>\n</li>\n<li><p>配置：</p>\n<ol>\n<li><p>接口修改为trunk模式</p>\n</li>\n<li><p>定义VLAN 的允许列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port trunk allow-pass vlan all</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>启用QINQ 的VLAN 转换能力</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">qinq vlan-translation enable</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>定义VLAN 的映射列表</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> port vlan-mapping vlan [私有num1] map-vlan [公有num2]</span><br><span class=\"line\">.....</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"8-QINQ技术：\"><a href=\"#8-QINQ技术：\" class=\"headerlink\" title=\"8.QINQ技术：\"></a>8.QINQ技术：</h4><ul>\n<li><p>双层或多层VLAN 标记来穿越二层的ISP技术</p>\n</li>\n<li><p>内层VLAN标签为私网传递标签，外层VLAN标签为公网传递标签</p>\n</li>\n<li><p>用于私有VLAN通信</p>\n</li>\n<li><p>配置：</p>\n<ol>\n<li><p>接口封装为802.1Q的隧道模式</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port link-type dot1q-tunnel</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>添加端口的PVID（接口接收到的所有数据帧都增加802.1Q的新标记）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port default vlan [num]</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"9-802-1Q堆叠技术\"><a href=\"#9-802-1Q堆叠技术\" class=\"headerlink\" title=\"9.802.1Q堆叠技术\"></a>9.802.1Q堆叠技术</h4><ul>\n<li><p>在VLAN标签上添加一层VLAN标签</p>\n</li>\n<li><p><strong>华为私有技术</strong></p>\n</li>\n<li><p>配置：</p>\n<ol>\n<li><p>接口必须为hybrid接口</p>\n</li>\n<li><p>启用QINQ VLAN 映射功能</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">qinq vlan-translation enable</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>针对不同的VLAN 的 定义不同的堆叠VLAN</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port vlan-stacking vlan [内层num1] stack-vlan [外层num2]    # 给VLAN-num1添加一层VLAN-num2</span><br><span class=\"line\">......</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在接口的移除标签列表中增加对应的VLAN ID</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">port hybrid untagged vlan [num1] ....    </span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li><p>使用VLAN 单臂路由（路由器中配置）</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">interface g[子端口]                         # 如：0/0/0.1，创建子接口</span><br><span class=\"line\">dot1q termination vid [num]                # 定义其管理的VLAN</span><br><span class=\"line\">ip address [IP地址] [子网掩码/网络地址长度]</span><br><span class=\"line\">arp broadcast enable                         # 开启ARP功能</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用SVI接口（VLAN-if）</p>\n<ul>\n<li><p><strong>交换虚拟接口</strong>，代替路由器上的子接口进行VLAN’之间的通信；交换机上针对不同的VLAN 可以设置的接口（此接口为3层接口）</p>\n</li>\n<li><p>功能：</p>\n<ul>\n<li>充当对应VLAN 之内的网关 ，为不同VLAN 之间通信提供可能</li>\n<li>方便用户进行远程控制（telnet ssh）</li>\n</ul>\n</li>\n<li><p>SVI 存在条件: </p>\n<ul>\n<li>交换机存在属于SVI接口对应VLAN ID 的活动接口</li>\n<li>Trunk 链路，SVI对应VLAN id 存在于trunk链路的VLAN 允许列表之内 </li>\n<li>针对三层交换机，可以创建多个SVI –多个SVI可以同时工作，但对于二层交换机，启用多个SVI时，只有最后一个SVI 是up的</li>\n</ul>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>创建SVI（vlan-if）接口：（需要配置两个接口）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int vlanif[num]    # num和VLAN-ID一致，相当于VLAN对应的子接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>在SVI接口中配置IP地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip address [IP地址] [子网掩码/网络地址长度]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display ip interface brief</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>主机需要配置网关，即SVI接口的IP地址</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-生成树：\"><a href=\"#2-生成树：\" class=\"headerlink\" title=\"2.生成树：\"></a>2.生成树：</h3><h4 id=\"1-概念：-1\"><a href=\"#1-概念：-1\" class=\"headerlink\" title=\"1.概念：\"></a>1.概念：</h4><ul>\n<li><p>为了保证交换网络高可用性，在交换机之间使用<strong>冗余链路</strong>（备用路线），由于网络中的<strong>泛洪机制</strong>可能造成二层的桥接环路，会导致 </p>\n<ul>\n<li>广播风暴 </li>\n<li>Mac地址表的不稳定 </li>\n<li>数据帧的重复拷贝</li>\n</ul>\n</li>\n<li><p>解决思路： 打破交换网络中的环路（针对交换网络的所有环路中，关闭其中的某个接口）</p>\n</li>\n<li><p>生成树协议（ spanning tree protocol ，STP ）：</p>\n<ul>\n<li>所有的生成树协议都在通过收送比较信息进行选举</li>\n<li>找到环路中应该被关闭的接口（<strong>接口阻塞</strong>）</li>\n</ul>\n</li>\n<li><p>收送的比较的信息称为<strong>BPDU，网桥协议数据单元</strong></p>\n</li>\n<li><p>生成树的类型： </p>\n<table>\n<thead>\n<tr>\n<th>生成树的类型：</th>\n<th>简称</th>\n<th>别名</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>标准生成树协议</td>\n<td>STP</td>\n<td>802.1D</td>\n</tr>\n<tr>\n<td>快速生成树协议</td>\n<td>RSTP</td>\n<td>802.1W</td>\n</tr>\n<tr>\n<td>多生成树协议</td>\n<td>MSTP</td>\n<td>802.1S</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>BPDU 网桥协议数据单元类型：</p>\n<table>\n<thead>\n<tr>\n<th>单元类型：</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>配置BPDU</td>\n<td>config-BPDU，<strong>用于生成树的选举</strong>以及重收敛</td>\n</tr>\n<tr>\n<td>拓扑变更BPDU</td>\n<td>TC-BPDU，通知交换网络出现了拓扑变更</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h4 id=\"2-BPDU-的数据结构：\"><a href=\"#2-BPDU-的数据结构：\" class=\"headerlink\" title=\"2.BPDU 的数据结构：\"></a>2.BPDU 的数据结构：</h4><table>\n<thead>\n<tr>\n<th>字段</th>\n<th>所占字节</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Protocol ID：协议ID</td>\n<td>2</td>\n<td></td>\n</tr>\n<tr>\n<td>Version：协议版本ID</td>\n<td>1</td>\n<td>1：标准生成树，2：快速生成树，3：多生成树</td>\n</tr>\n<tr>\n<td>Message type：类型</td>\n<td>1</td>\n<td>代表着BPDU 的类型 （0X00：配置BPDU；0X80：拓扑变更BPDU）</td>\n</tr>\n<tr>\n<td>Flags：标志</td>\n<td>1</td>\n<td>标记位，在802.1D 中，标识BPDU是拓扑变更，还是拓扑变更确认BPDU</td>\n</tr>\n<tr>\n<td><strong>Root ID：根桥ID</strong></td>\n<td>8</td>\n<td>根标识符，RID，用于标记一颗树的树根。<strong>与网桥的BID 一致</strong>。</td>\n</tr>\n<tr>\n<td><strong>Cost of path：根路径开销</strong></td>\n<td>4</td>\n<td>路径开销。在华为设备中，称作 root path cost （RPC）根路径开销</td>\n</tr>\n<tr>\n<td><strong>Bridge ID：网桥ID</strong></td>\n<td>8</td>\n<td>网桥标识符， BID ， 用于标识本设备在<strong>本生成树的唯一性</strong>，组成：<strong>优先级+扩展ID+MAC</strong></td>\n</tr>\n<tr>\n<td><strong>Port ID：接口ID</strong></td>\n<td>2</td>\n<td>端口标识符， PID ，用于标识设备上<strong>某接口的唯一性</strong>，组成：<strong>优先级+端口标识符</strong></td>\n</tr>\n<tr>\n<td>Message age：消息寿命</td>\n<td>2</td>\n<td>思科默认300s，代表老化时间；华为默认0，过一台交换机+1，代表BPDU传递的跳数</td>\n</tr>\n<tr>\n<td>Max age：最大寿命</td>\n<td>2</td>\n<td>最大时间，可以理解为hello包的<strong>超时时间默认20s</strong></td>\n</tr>\n<tr>\n<td>Hellotime：hello时间</td>\n<td>2</td>\n<td><strong>默认为2s</strong> ，BPDU 收送的间隔</td>\n</tr>\n<tr>\n<td>Forward delay：转发延迟</td>\n<td>2</td>\n<td>转收延时，状态切换时间，默认为15s</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p>对于STP而言，最重要的工作就是在交换网络中计算出一个无环拓扑（<strong>生成树选路四字段</strong>）</p>\n<ul>\n<li>在拓扑计算的过程中，一个非常重要的内容就是配置BPUDU的比较，STP按照如下顺序选择最优的配置BPDU<ol>\n<li>最小的根桥ID</li>\n<li>最小的RPC（根路径开销）</li>\n<li>最小的网桥ID</li>\n<li>最小的接口ID</li>\n</ol>\n</li>\n<li>第一条原则主要用于在网络中选举根桥，后面的原则住哟啊用于选举根接口及指定接口</li>\n</ul>\n</li>\n<li><p>Max age：最大寿命 ：</p>\n<ul>\n<li>收到BPDU之后 将message age中的时间不max-hop进行比较</li>\n<li>若小于，则正常使用该BPDU ；若大于，则忽略BPDU</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"3-BID与PID：\"><a href=\"#3-BID与PID：\" class=\"headerlink\" title=\"3.BID与PID：\"></a>3.BID与PID：</h4><ul>\n<li>BID网桥标识符：本设备在<strong>本生成树的唯一性</strong><ul>\n<li>构成：8字节</li>\n<li>组成：<ul>\n<li>BID优先级字段：<ul>\n<li>4位，默认值为32768； 范围0-65535（实际范围0-61440）</li>\n<li>越小越优</li>\n<li>BID优先级单位为4096，调整BID优先级时 值必须<strong>为4096的倍数</strong></li>\n</ul>\n</li>\n<li>扩展系统ID：12位，在802.1D和802.1W 无意义，<strong>在802.1S（快速生成树）中有用的</strong></li>\n<li>Mac地址：6字节，为交换机 背板地址池中所有MAC地址中最小的，<strong>MAC地址越小越优</strong></li>\n</ul>\n</li>\n<li>BID 的使用：比较BID 优先级，比较MAC地址</li>\n</ul>\n</li>\n<li>PID端口标识符：设备上<strong>某接口的唯一性</strong><ul>\n<li>构成：2字节</li>\n<li>组成：<ul>\n<li>PID优先级：4位，默认值为128，范围0-255（实际范围0-240），单位为16</li>\n<li>端口标识符：12位，标识唯一性</li>\n</ul>\n</li>\n<li>使用方法：比较PID优先级，Port number</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"4-RTC根路径开销\"><a href=\"#4-RTC根路径开销\" class=\"headerlink\" title=\"4.RTC根路径开销:\"></a>4.RTC根路径开销:</h4><ul>\n<li><p>COST： 开销值，不同带宽的链路使用不同的cost （该cost值是内部编码的），非线性过程。</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221211210243734.png\" alt=\"image-20221211210243734\"></p>\n</li>\n</ul>\n<h4 id=\"5-端口角色和端口状态：\"><a href=\"#5-端口角色和端口状态：\" class=\"headerlink\" title=\"5.端口角色和端口状态：\"></a>5.端口角色和端口状态：</h4><ul>\n<li><p>端口角色：</p>\n<table>\n<thead>\n<tr>\n<th>角色</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>根端口 （RP）</td>\n<td>存在于非根网桥之上，<strong>一个非根网桥仅有一个</strong>，用于<strong>接收来自于根的BPDU</strong></td>\n</tr>\n<tr>\n<td>指定端口（DP）</td>\n<td>在一条链路中有且仅有一个，用于<strong>转收发BPDU</strong></td>\n</tr>\n<tr>\n<td>阻塞端口（NDP）</td>\n<td>被逻辑上关闭的接口</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>端口状态：</p>\n<table>\n<thead>\n<tr>\n<th>状态</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>disable关闭状态</td>\n<td>1.关闭生成树协议 2.接口物理关闭</td>\n</tr>\n<tr>\n<td><strong>blocking阻塞状态</strong></td>\n<td>不能收送BPDU ，可以接收BPDU ，不能収送和接收数据，20秒后进入监听状态</td>\n</tr>\n<tr>\n<td>listening监听状态</td>\n<td>可以收送幵接收BPDU，不能收送和接收数据；（进行生成树选举的），15秒后进入学习状态</td>\n</tr>\n<tr>\n<td>learning学习状态</td>\n<td>可以收送幵接收BPDU，不能收送和接收数据；（学习MAC地址表），目的：限制未知单播帧的泛洪；15秒后进入转收状态</td>\n</tr>\n<tr>\n<td><strong>forwarding转收状态</strong></td>\n<td>可以收送幵接收 BPDU和数据</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<h4 id=\"6-生成树选举：\"><a href=\"#6-生成树选举：\" class=\"headerlink\" title=\"6.生成树选举：\"></a>6.生成树选举：</h4><ul>\n<li><strong>802.1D生成树收敛时间：30s或50s</strong></li>\n<li>生成树选举：<ol>\n<li>选举 根网桥，选举规则： 最小的BID（BID由优先级+扩展ID+MAC地址组成）</li>\n<li>选举端口角色<ul>\n<li>选举根端口RP：<ol>\n<li>接口最小的开销值（RPC+PC）</li>\n<li>最小的BID（发送方的）</li>\n<li>最小的PID（发送方的）</li>\n</ol>\n</li>\n<li>选举指定端口DP：（两个交换机之间的比较）<ol>\n<li>根端口的最小开销值</li>\n<li>最小的BID（本设备）</li>\n<li>最小的PID（本设备）</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"7-生成树的配置：\"><a href=\"#7-生成树的配置：\" class=\"headerlink\" title=\"7.生成树的配置：\"></a>7.生成树的配置：</h4><ul>\n<li><p>选择 &#x2F; 修改生成树类型：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp mode [stp/rstp/mstp]</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">默认stp标准生成树（802.1D），rstp快速生成树（802.1W），mstp多生成树（802.1S）</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改BID优先级： 干涉根网桥选举</p>\n<ol>\n<li><p>方式一：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp priority [num]    # 范围0-61440，值必须为4096的倍数，越小越优</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>方式二：设置主备根</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp root [primary/secondary]    # primary等于修改优先级为0，secondary等于修改优先级为4096</span><br></pre></td></tr></table></figure></li>\n</ol>\n</li>\n<li><p>修改接口的cost值：干涉端口选举</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp cost [num]   # 范围1-200000000，先进入接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改接口的PID优先级：干涉端口选举</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp port priority [num]   # 范围0-240，先进入接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看生成树：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display stp</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看生成树端口状态：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display stp brief</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h4 id=\"8-802-1D标准生成树协议：\"><a href=\"#8-802-1D标准生成树协议：\" class=\"headerlink\" title=\"8.802.1D标准生成树协议：\"></a>8.802.1D标准生成树协议：</h4><ul>\n<li><p>连接终端的接口，启用之后进入转收状态需要30s，可以加速。（在cisco中使用portfast , 华为中可以使用边缘端口）</p>\n<ul>\n<li><p>节约时间： 30 s </p>\n</li>\n<li><p>开启边缘端口：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp edged-port enable    # 先进接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display current interface [接口号]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>上行链路状态切换 ，切换时间为30s ，思科中可以使用uplink-fast 进行加速（节约30s）</p>\n</li>\n<li><p>骨干链路故障切换，思科中默认为50s（20+15+15；思科中可以使用backbone-fast进行加速，节约时间20s）华为切换时间默认为30s</p>\n</li>\n<li><p>802.1D 生成树的重收敛：使用拓扑变更BPDU</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221212140616828.png\" alt=\"image-20221212140616828\"></p>\n</li>\n</ul>\n<h4 id=\"9-802-1W快速生成树协议：\"><a href=\"#9-802-1W快速生成树协议：\" class=\"headerlink\" title=\"9.802.1W快速生成树协议：\"></a>9.802.1W快速生成树协议：</h4><ul>\n<li><p>802.1W <strong>基于PA机制进行收敛</strong>（请求 同意），可以在2-3 s之内完成收敛。基于BPDU flags字段内容进行分布式收敛</p>\n<p><img src=\"C:\\Users\\user\\AppData\\Roaming\\Typora\\typora-user-images\\image-20221212141320738.png\" alt=\"image-20221212141320738\"></p>\n</li>\n<li><p><strong>生成树选举：与802.1D完全一致</strong></p>\n</li>\n<li><p>端口状态：</p>\n<table>\n<thead>\n<tr>\n<th>状态</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Discarding丢弃状态</td>\n<td>可以收送开接收BPDU，但是不能收送接收数据</td>\n</tr>\n<tr>\n<td>Learning学习状态</td>\n<td>可以收送幵接收BPDU，不能收送和接收数据；（学习MAC地址表），目的：限制未知单播帧的泛洪；</td>\n</tr>\n<tr>\n<td>Forwarding转收状态</td>\n<td>可以收送幵接收 BPDU和数据</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>端口角色：</p>\n<table>\n<thead>\n<tr>\n<th>角色</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>根端口</td>\n<td>存在于非根网桥之上，<strong>一个非根网桥仅有一个</strong>，用于<strong>接收来自于根的BPDU</strong></td>\n</tr>\n<tr>\n<td>指定端口</td>\n<td>在一条链路中有且仅有一个，用于<strong>转收发BPDU</strong></td>\n</tr>\n<tr>\n<td>替代端口</td>\n<td>阻塞，同一个交换机上使用阻塞端口<strong>替代根端口</strong>，替换时间0s，相当于自劢集成uplink-fast</td>\n</tr>\n<tr>\n<td>备份端口</td>\n<td>阻塞，同一个交换机上针对同一条链路<strong>备份指定端口</strong>，备份端口切换时间30s，不能使用802.1W的机制</td>\n</tr>\n<tr>\n<td>边缘端口</td>\n<td>边缘端口 、非边缘端口 ，一般在连接终端的接口上实施（access）</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>边缘端口：</p>\n<ul>\n<li><p>配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp edged-port enable    # 先进接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>作用：</p>\n<ol>\n<li>自动启用端口加速（节约30s）</li>\n<li>若收到 proposal 置位的BPUD，边缘端口不会同步</li>\n<li>若收到了TC位置位的配置BPDU，不通过边缘端口转收</li>\n<li>若启用边缘端口的接口收到了BPDU，则边缘端口特性失效</li>\n<li>若收到TC位置位的BPDU，边缘端口学习到的MAC地址时间不变化（依然为300s）</li>\n</ol>\n</li>\n</ul>\n</li>\n<li><p>链路类型： </p>\n<ul>\n<li>point-to-point 点对点类型（强制链路类型）</li>\n<li>shared 共享型</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"10-802-1D与802-1W的区别：\"><a href=\"#10-802-1D与802-1W的区别：\" class=\"headerlink\" title=\"10.802.1D与802.1W的区别：\"></a>10.802.1D与802.1W的区别：</h4><table>\n<thead>\n<tr>\n<th></th>\n<th>802.1D</th>\n<th>802.1W</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>收敛机制</td>\n<td></td>\n<td>PA机制</td>\n</tr>\n<tr>\n<td>收敛时间</td>\n<td>30s或50s</td>\n<td>2-3 s</td>\n</tr>\n<tr>\n<td>端口状态</td>\n<td>3个</td>\n<td>3个</td>\n</tr>\n<tr>\n<td>端口角色</td>\n<td>5个</td>\n<td>4个</td>\n</tr>\n<tr>\n<td>是否支持边缘端口</td>\n<td></td>\n<td>支持，但默认不启用的</td>\n</tr>\n<tr>\n<td>负载分担</td>\n<td>不支持</td>\n<td></td>\n</tr>\n<tr>\n<td>上行链路加速</td>\n<td>不支持</td>\n<td>自动集成，节约30s</td>\n</tr>\n<tr>\n<td>骨干链路加速</td>\n<td></td>\n<td>自动集成，节约50s</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>超时时间</td>\n<td>20s</td>\n<td>6s</td>\n</tr>\n<tr>\n<td>配置</td>\n<td>一致</td>\n<td>一致</td>\n</tr>\n</tbody></table>\n<h4 id=\"11-802-1S多生成树协议\"><a href=\"#11-802-1S多生成树协议\" class=\"headerlink\" title=\"11.802.1S多生成树协议\"></a>11.802.1S多生成树协议</h4><ul>\n<li><p>配置：</p>\n<ul>\n<li><p>启用MSTP模式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp mode mstp</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>进入多生成树的配置模式：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp region-configuration</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>域名 name </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">region-name [域名]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>reversion leave 版本等级，同域中版本必须一致</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">revision-level [num]   # 例：10</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>instance 实例映射，同域中实例映射必须一致</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">instance [实例ID] vlan [num] to [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改instance 1 的BID 优先级</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp instance [实例ID] priority [num]     # 优先级范围0-61440</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改instance 1 的PID 或COST值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp instance [实例ID] cost [num]     </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使当前临时配置生效：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">active region-configuration</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display stp region-configuration</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置实例的主根与备份根：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp instance [num] root [primary/secondary]   # 在配置模式下</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看实例接口情况：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display stp instance [num] brief</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"12-生成树的弹性（特性）：\"><a href=\"#12-生成树的弹性（特性）：\" class=\"headerlink\" title=\"12.生成树的弹性（特性）：\"></a>12.生成树的弹性（特性）：</h4><ol>\n<li><p>portfast：边缘端口</p>\n</li>\n<li><p>uplink fast：上行链路加速</p>\n</li>\n<li><p>backbone fast：骨干链路加速</p>\n</li>\n<li><p>BPDU 防护：若启用了BPDU防护的接口收到BPDU ，则会导致接口error-down；<strong>默认华为BPDU 防护只能全局设置</strong>，幵且仅仅针对边缘端口；思科中的BPDU guard 可以针对接口也可以针对全局</p>\n<ul>\n<li><p>全局配置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp bpdu-protection</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>恢复由于BPDU 防护导致接口error-down</p>\n<ul>\n<li><p>手工：先物理关闭接口 再重新开启</p>\n</li>\n<li><p>自动：开启自动恢复</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">error-down auto-recover causer bpdu-protection interval 30</span><br><span class=\"line\">display error-down recovery    # 查看</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>BPDU-fitter：BPDU 过滤，开吭之后，该接口丌収送也不接收BPDU信息，若接收到了BPDU ，则直接忽略</p>\n<ul>\n<li><p>全局启用：全局启用同样仅仅针对边缘端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp bpdu-filter default</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>接口启用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp bpdu-filter enable      # 先进入接口</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>root-protection：根防护，一般建议在连接新交换机的接口上启用，若该接口收到了优质根的BPDU信息，则接口进入discarding</p>\n<ul>\n<li><p>接口上启动：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp root-protection    # 先进入接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display stp instance [实例ID] brief</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>loop-protection：环路防护，防止当出现单向链路故障时，导致生成树出现转收环路，所以可以在阻塞端口上启用loop-protection ，使阻塞接口可以收送BPDU ，进行链路双向检测</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stp loop-protection    # 先进入接口</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"3-企业网三层架构：\"><a href=\"#3-企业网三层架构：\" class=\"headerlink\" title=\"3.企业网三层架构：\"></a>3.企业网三层架构：</h3><table>\n<thead>\n<tr>\n<th>分层</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>核心层</td>\n<td>高速的包交换，必要的路由策略</td>\n</tr>\n<tr>\n<td>汇聚层</td>\n<td>复杂的路由策略</td>\n</tr>\n<tr>\n<td>接入层</td>\n<td>拥有大量的接口，用于与最终用户计算机相连</td>\n</tr>\n</tbody></table>\n<h3 id=\"4-Eth-Trunk以太中继：\"><a href=\"#4-Eth-Trunk以太中继：\" class=\"headerlink\" title=\"4.Eth-Trunk以太中继：\"></a>4.Eth-Trunk以太中继：</h3><ul>\n<li><p>通讯技术<strong>将多个物理接口逻辑的整合为一个接口，实现带宽叠加</strong>的作用</p>\n</li>\n<li><p>分类：</p>\n<ul>\n<li>二层ether-trunk：提高链路的带宽，减少了阻塞端口的数量，增强网络稳定性</li>\n<li>三层ether-trunk：提高链路的带宽，增强网络的稳定性</li>\n</ul>\n</li>\n<li><p>LACP：链路聚合控制协议，公有协议</p>\n<ul>\n<li>发送LACPDU进行以太信道的协商</li>\n<li>最大支持在16条链路上进行以太信道写协商，只能适用8条</li>\n<li>当使用16链路进行协商，选择条为主链路，其余条为备份链路</li>\n</ul>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>前提条件：</p>\n<ol>\n<li>通道内所有接口必须支持eth-trunk</li>\n<li>通道内所有接口必须具有相同速率和双工</li>\n<li>若接口为access，则要整合的接口必须全为access，并且属于同一VLAN</li>\n<li>若接口为trunk，则要整合的接口必须具备相同的trunk VLAN 允许列表</li>\n<li>若启动的三层ether0trunk，则IP地址配置在eth-trunk</li>\n<li>通道内<strong>要整合的接口连接的是同一设备</strong></li>\n</ol>\n</li>\n<li><p>创建以太网中继接口：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int eth-trunk [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>将物理接口划入eth-trunk，划入接口无其他配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trunkport [接口号1] ......    # 先进入以太网中继接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看以太中继接口状态：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display eth-trunk [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>调整接口的负载均衡方式：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">load-balance [方式]</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"5-冗余（备份）：\"><a href=\"#5-冗余（备份）：\" class=\"headerlink\" title=\"5.冗余（备份）：\"></a>5.冗余（备份）：</h3><ul>\n<li><p>分类：</p>\n<ul>\n<li>链路冗余：备份线路</li>\n<li>设备冗余：备份设备</li>\n<li>电源冗余：备份电源</li>\n<li>引擎冗余：备份主板</li>\n<li>网关冗余：HSRP热备份网关冗余协议，VRRP-GLBP网关负载均衡协议</li>\n</ul>\n</li>\n<li><p>VRRP虚拟网关冗余协议：工业标准</p>\n<ul>\n<li><p>VRRP是一种冗余备份协议，为具有组播成广播能力的局城网（如以太网）设计，保证当局城网内主机的下一跳路由器设备出现故障时，可以及时的有另一台路由器来代替，从而保持网络通信的连续性和可靠性</p>\n</li>\n<li><p>一个VRRP中，指定一个VIP地址（虚拟IP地址），产生一个VMac地址（0000-5e00-01xx,前10位固定）</p>\n</li>\n<li><p>特点：</p>\n<ul>\n<li>hello时间为1s，hold时间为3.6s</li>\n<li>在<strong>选举</strong>过程中发送hello，若选举完成之后仅仅master发送hello，源MAC地址为VMAC，目标IP地址为224.0.0.18</li>\n<li>选举一个master多个backup</li>\n<li>抢占式开启的</li>\n<li>VRRP master 选举： 1.比较最大的优先级 2.比较最大的IP地址 （优先级默认为100 ， 范围1-255 ，数值越大越优）</li>\n<li>VRRP中的虚拟IP地址也可以为某个备份网段的真实IP地址 ，同时该备份网段的优先级默认为255。（HSRP GLBP中不能为真实IP地址）</li>\n</ul>\n</li>\n<li><p>路由器接口配置：另一台路由器也需要配置相同编号的虚拟地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vrrp vrid [num] virtual-ip [虚拟IP地址]    # 先进入接口，num为vrid编号</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display vrrp int [接口号]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>stp修改参选优先级：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vrrp vrid [num] priority [num]   # 优先级默认为100，越大越优</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>监视上行链路：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vrrp vrid [num] track interface [接口号] reduced [num]    </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">监视出接口处的链路，如果上行链路出现问题优先级减num(会累加)</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设置抢占延迟时间：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vrrp vrid [num] preempt-mode timer delay [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>VRRP 切换：</p>\n<ul>\n<li><p>下行链路（路由器与交换机的链路）切换：不VRRP的超时时间有关，默认为3s</p>\n</li>\n<li><p>上行链路切换：与路由表的重新收敛有关，可以使用 track 跟踪 （优化）</p>\n</li>\n<li><p>VRRP 实现流量的负载均衡： 需要创建多个VRID 组 ，一个组一个VIP 不同的VRID 设置不同的master路由器；</p>\n</li>\n<li><p>BFD ： 双向转收检测技术</p>\n</li>\n<li><p>配置：</p>\n<ul>\n<li><p>启用BFD功能：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bfd</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>创建BFD会话：设置检测的目标和源IP地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bfd [会话名] bind peer-ip [目标IP地址] source-ip [源IP地址]   </span><br></pre></td></tr></table></figure>\n</li>\n<li><p>静态配置双方标识符：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">discriminator local [num]</span><br><span class=\"line\">discriminator remote [num]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>提交配置：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commit</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看BFD会话：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display bfd session all</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>VRRP 中调用：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vrrp vrid [num] track bfd-session session-name [会话名]   # 先进入接口</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">display vrrp</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","_path":"2023/03/19/1.网络基础/6.交换技术和三层架构/","_link":"https://example.com/2023/03/19/1.%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/6.%E4%BA%A4%E6%8D%A2%E6%8A%80%E6%9C%AF%E5%92%8C%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84/","_id":"clffcvmi1000gu4q4ckx70z4w"}}